MODULE YOMSLPHY

!$ACDC methods 


USE PARKIND1, ONLY : JPIM, JPRB
USE YOMHOOK,  ONLY : LHOOK, DR_HOOK, JPHOOK

IMPLICIT NONE

SAVE


TYPE :: TSLPHY

!     ------------------------------------------------------------------

! * Variables for split ECMWF physics.

! RSLWX   : level of implicitness of semi-Lagrangian/physics.
! NVTEND  : third dimension of SAVTEND (number of 3D fields).
! SAVTEND : buffer to store physical tendencies.
! SAVTEND5: trajectory for SAVTEND.

REAL(KIND=JPRB),ALLOCATABLE :: RSLWX(:)
INTEGER(KIND=JPIM) :: NVTEND
REAL(KIND=JPRB),ALLOCATABLE :: SAVTEND(:,:,:,:)
REAL(KIND=JPRB),ALLOCATABLE :: SAVTEND5(:,:,:,:)
! Pointers for SAVTEND
INTEGER(KIND=JPIM) :: MU_SAVTEND,MV_SAVTEND,MT_SAVTEND
!----------------------------------------------------------------------------
CONTAINS
  PROCEDURE, PASS :: PRINT => PRINT_CONFIGURATION 
PROCEDURE :: ACDC_COPY => ACDC_COPY_TSLPHY
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_TSLPHY
PROCEDURE :: ACDC_HOST => ACDC_HOST_TSLPHY
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_TSLPHY
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_TSLPHY
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_TSLPHY
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_TSLPHY
END TYPE TSLPHY
!============================================================================
!TYPE(TSLPHY), POINTER :: YRSLPHY => NULL()

INTERFACE

MODULE SUBROUTINE ACDC_COPY_TSLPHY (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TSLPHY), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_TSLPHY (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (TSLPHY), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_TSLPHY (SELF)

IMPLICIT NONE
CLASS (TSLPHY), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_TSLPHY (SELF, KLUN)
USE PARKIND1, ONLY : JPRD
IMPLICIT NONE
CLASS (TSLPHY), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_TSLPHY (SELF, KLUN)

IMPLICIT NONE
CLASS (TSLPHY), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_TSLPHY (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
CLASS (TSLPHY),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_TSLPHY (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TSLPHY), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS

SUBROUTINE PRINT_CONFIGURATION(SELF, KDEPTH, KOUTNO)
  IMPLICIT NONE
  CLASS(TSLPHY), INTENT(IN) :: SELF
  INTEGER      , INTENT(IN) :: KDEPTH
  INTEGER      , INTENT(IN) :: KOUTNO

  INTEGER :: IDEPTHLOC
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('YOMSLPHY:PRINT_CONFIGURATION',0,ZHOOK_HANDLE)
  IDEPTHLOC = KDEPTH+2
  
  WRITE(KOUTNO,*) REPEAT(' ',KDEPTH   ) // 'model%yrml_phy_g%yrslphy : '
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NVTEND = ', SELF%NVTEND
  IF (ALLOCATED(SELF%SAVTEND)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'SAVTEND allocated of shape ', &
    & SHAPE(SELF%SAVTEND)
  IF (ALLOCATED(SELF%SAVTEND5)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'SAVTEND5 allocated of shape ',&
    & SHAPE(SELF%SAVTEND5)
  IF (ALLOCATED(SELF%RSLWX)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'RSLWX allocated of shape ',&
    & SHAPE(SELF%RSLWX)
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'MU_SAVTEND = ', SELF%MU_SAVTEND
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'MV_SAVTEND = ', SELF%MV_SAVTEND
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'MT_SAVTEND = ', SELF%MT_SAVTEND
IF (LHOOK) CALL DR_HOOK('YOMSLPHY:PRINT_CONFIGURATION',1,ZHOOK_HANDLE)

END SUBROUTINE PRINT_CONFIGURATION

END MODULE YOMSLPHY
