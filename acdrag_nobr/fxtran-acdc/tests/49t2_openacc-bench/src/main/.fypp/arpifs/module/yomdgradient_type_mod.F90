MODULE YOMDGRADIENT_TYPE_MOD

!$ACDC methods --methods-list=host,wipe,copy --skip-components cpg --field-api --field-api-class cpg


USE FIELD_MODULE
USE FIELD_REGISTRY_MOD
USE PARKIND1, ONLY : JPRB, JPIM, JPIB
USE YOM_YGFL, ONLY : TYPE_GFL_COMP

IMPLICIT NONE

TYPE GRADIENT_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_DUDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DUDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DUDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DUDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DUDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DUDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DUDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DUDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DVDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DVDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DVDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DVDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DVDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DVDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DVDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DVDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DTDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DTDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DTDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DTDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DTDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DTDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DTDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DTDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQVDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQVDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQVDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQVDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQVDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQVDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQVDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQVDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQLDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQLDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQLDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQLDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQLDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQLDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQLDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQLDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQIDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQIDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQIDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQIDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQIDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQIDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQIDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQIDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQRDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQRDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQRDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQRDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQRDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQRDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQRDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQRDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQSDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQSDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQSDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQSDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQSDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQSDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQSDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQSDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQGDX = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQGDX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQGDX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQGDX => NULL ()
  INTEGER (KIND=JPIM) :: IP_DQGDY = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DQGDY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DQGDY (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DQGDY => NULL ()
  INTEGER (KIND=JPIM) :: IP_DU2DX2 = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DU2DX2 (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DU2DX2 (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DU2DX2 => NULL ()
  INTEGER (KIND=JPIM) :: IP_DU2DY2 = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DU2DY2 (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DU2DY2 (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DU2DY2 => NULL ()
  INTEGER (KIND=JPIM) :: IP_DV2DX2 = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DV2DX2 (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DV2DX2 (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DV2DX2 => NULL ()
  INTEGER (KIND=JPIM) :: IP_DV2DY2 = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DV2DY2 (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DV2DY2 (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DV2DY2 => NULL ()
  INTEGER (KIND=JPIM) :: IP_DUDXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DUDXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DUDXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DUDXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DUDYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DUDYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DUDYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DUDYZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DVDXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DVDXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DVDXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DVDXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DVDYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DVDYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DVDYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DVDYZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DWDXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DWDXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DWDXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DWDXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DWDYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DWDYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DWDYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DWDYZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DRVDXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DRVDXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DRVDXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DRVDXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DRVDYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DRVDYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DRVDYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DRVDYZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DRLDXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DRLDXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DRLDXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DRLDXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DRLDYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DRLDYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DRLDYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DRLDYZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DRIDXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DRIDXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DRIDXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DRIDXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DRIDYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DRIDYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DRIDYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DRIDYZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DTHETADXZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DTHETADXZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DTHETADXZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DTHETADXZ => NULL ()
  INTEGER (KIND=JPIM) :: IP_DTHETADYZ = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DTHETADYZ (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DTHETADYZ (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DTHETADYZ => NULL ()

CONTAINS
  PROCEDURE :: INIT => GRADIENT_TYPE_INIT
  PROCEDURE :: CONFORM => GRADIENT_TYPE_CONFORM
  PROCEDURE :: RESIZE => GRADIENT_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => GRADIENT_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => GRADIENT_TYPE_FINAL
END TYPE GRADIENT_TYPE

REAL (KIND=JPRB), TARGET, SAVE:: ZDUM2(1,1), ZDUM3(1,1,1)

CONTAINS

SUBROUTINE GRADIENT_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTGRADIENT_PTR &
                        & , PERSISTENT &
                        & , PTGRADIENT_PTR &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE YOMDGRADIENT, ONLY : TGRADIENT_PTR
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (GRADIENT_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TGRADIENT_PTR),                    INTENT (IN)    :: YDTGRADIENT_PTR
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTGRADIENT_PTR (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTGRADIENT_PTR)) THEN
  SELF%ZDATA => PTGRADIENT_PTR (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTGRADIENT_PTR%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTGRADIENT_PTR%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_DUDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DUDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DUDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DUDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DVDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DVDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DVDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DVDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DTDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DTDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DTDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DTDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQVDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQVDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQVDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQVDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQLDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQLDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQLDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQLDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQIDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQIDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQIDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQIDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQRDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQRDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQRDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQRDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQSDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQSDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQSDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQSDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQGDX, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQGDX, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DQGDY, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DQGDY, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DU2DX2, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DU2DX2, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DU2DY2, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DU2DY2, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DV2DX2, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DV2DX2, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DV2DY2, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DV2DY2, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DUDXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DUDXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DUDYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DUDYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DVDXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DVDXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DVDYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DVDYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DWDXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DWDXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DWDYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DWDYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DRVDXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DRVDXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DRVDYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DRVDYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DRLDXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DRLDXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DRLDYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DRLDYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DRIDXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DRIDXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DRIDYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DRIDYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DTHETADXZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DTHETADXZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DTHETADYZ, DATA=SELF%ZDATA (:, :, YDTGRADIENT_PTR%M_DTHETADYZ, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE GRADIENT_TYPE_INIT

SUBROUTINE GRADIENT_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTGRADIENT_PTR, PERSISTENT)

USE YOMDGRADIENT, ONLY : TGRADIENT_PTR

CLASS (GRADIENT_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TGRADIENT_PTR),                    INTENT (IN)    :: YDTGRADIENT_PTR
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTGRADIENT_PTR, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTGRADIENT_PTR, PERSISTENT)

ENDIF

END SUBROUTINE GRADIENT_TYPE_RESIZE

LOGICAL FUNCTION GRADIENT_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTGRADIENT_PTR, PERSISTENT) RESULT (LLCONFORM)

USE YOMDGRADIENT, ONLY : TGRADIENT_PTR
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (GRADIENT_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TGRADIENT_PTR),                    INTENT (IN)    :: YDTGRADIENT_PTR
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTGRADIENT_PTR%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION GRADIENT_TYPE_CONFORM

SUBROUTINE GRADIENT_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (GRADIENT_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_DUDX)) THEN
    IF ((.NOT. SELF%F_DUDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DUDX))) THEN
      SELF%DUDX => SELF%F_DUDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DUDX)) THEN
    SELF%DUDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DUDY)) THEN
    IF ((.NOT. SELF%F_DUDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DUDY))) THEN
      SELF%DUDY => SELF%F_DUDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DUDY)) THEN
    SELF%DUDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DVDX)) THEN
    IF ((.NOT. SELF%F_DVDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DVDX))) THEN
      SELF%DVDX => SELF%F_DVDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DVDX)) THEN
    SELF%DVDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DVDY)) THEN
    IF ((.NOT. SELF%F_DVDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DVDY))) THEN
      SELF%DVDY => SELF%F_DVDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DVDY)) THEN
    SELF%DVDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DTDX)) THEN
    IF ((.NOT. SELF%F_DTDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DTDX))) THEN
      SELF%DTDX => SELF%F_DTDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DTDX)) THEN
    SELF%DTDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DTDY)) THEN
    IF ((.NOT. SELF%F_DTDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DTDY))) THEN
      SELF%DTDY => SELF%F_DTDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DTDY)) THEN
    SELF%DTDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQVDX)) THEN
    IF ((.NOT. SELF%F_DQVDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQVDX))) THEN
      SELF%DQVDX => SELF%F_DQVDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQVDX)) THEN
    SELF%DQVDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQVDY)) THEN
    IF ((.NOT. SELF%F_DQVDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQVDY))) THEN
      SELF%DQVDY => SELF%F_DQVDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQVDY)) THEN
    SELF%DQVDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQLDX)) THEN
    IF ((.NOT. SELF%F_DQLDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQLDX))) THEN
      SELF%DQLDX => SELF%F_DQLDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQLDX)) THEN
    SELF%DQLDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQLDY)) THEN
    IF ((.NOT. SELF%F_DQLDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQLDY))) THEN
      SELF%DQLDY => SELF%F_DQLDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQLDY)) THEN
    SELF%DQLDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQIDX)) THEN
    IF ((.NOT. SELF%F_DQIDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQIDX))) THEN
      SELF%DQIDX => SELF%F_DQIDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQIDX)) THEN
    SELF%DQIDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQIDY)) THEN
    IF ((.NOT. SELF%F_DQIDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQIDY))) THEN
      SELF%DQIDY => SELF%F_DQIDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQIDY)) THEN
    SELF%DQIDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQRDX)) THEN
    IF ((.NOT. SELF%F_DQRDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQRDX))) THEN
      SELF%DQRDX => SELF%F_DQRDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQRDX)) THEN
    SELF%DQRDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQRDY)) THEN
    IF ((.NOT. SELF%F_DQRDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQRDY))) THEN
      SELF%DQRDY => SELF%F_DQRDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQRDY)) THEN
    SELF%DQRDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQSDX)) THEN
    IF ((.NOT. SELF%F_DQSDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQSDX))) THEN
      SELF%DQSDX => SELF%F_DQSDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQSDX)) THEN
    SELF%DQSDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQSDY)) THEN
    IF ((.NOT. SELF%F_DQSDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQSDY))) THEN
      SELF%DQSDY => SELF%F_DQSDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQSDY)) THEN
    SELF%DQSDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQGDX)) THEN
    IF ((.NOT. SELF%F_DQGDX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQGDX))) THEN
      SELF%DQGDX => SELF%F_DQGDX%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQGDX)) THEN
    SELF%DQGDX => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DQGDY)) THEN
    IF ((.NOT. SELF%F_DQGDY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DQGDY))) THEN
      SELF%DQGDY => SELF%F_DQGDY%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DQGDY)) THEN
    SELF%DQGDY => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DU2DX2)) THEN
    IF ((.NOT. SELF%F_DU2DX2%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DU2DX2))) THEN
      SELF%DU2DX2 => SELF%F_DU2DX2%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DU2DX2)) THEN
    SELF%DU2DX2 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DU2DY2)) THEN
    IF ((.NOT. SELF%F_DU2DY2%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DU2DY2))) THEN
      SELF%DU2DY2 => SELF%F_DU2DY2%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DU2DY2)) THEN
    SELF%DU2DY2 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DV2DX2)) THEN
    IF ((.NOT. SELF%F_DV2DX2%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DV2DX2))) THEN
      SELF%DV2DX2 => SELF%F_DV2DX2%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DV2DX2)) THEN
    SELF%DV2DX2 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DV2DY2)) THEN
    IF ((.NOT. SELF%F_DV2DY2%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DV2DY2))) THEN
      SELF%DV2DY2 => SELF%F_DV2DY2%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DV2DY2)) THEN
    SELF%DV2DY2 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DUDXZ)) THEN
    IF ((.NOT. SELF%F_DUDXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DUDXZ))) THEN
      SELF%DUDXZ => SELF%F_DUDXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DUDXZ)) THEN
    SELF%DUDXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DUDYZ)) THEN
    IF ((.NOT. SELF%F_DUDYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DUDYZ))) THEN
      SELF%DUDYZ => SELF%F_DUDYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DUDYZ)) THEN
    SELF%DUDYZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DVDXZ)) THEN
    IF ((.NOT. SELF%F_DVDXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DVDXZ))) THEN
      SELF%DVDXZ => SELF%F_DVDXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DVDXZ)) THEN
    SELF%DVDXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DVDYZ)) THEN
    IF ((.NOT. SELF%F_DVDYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DVDYZ))) THEN
      SELF%DVDYZ => SELF%F_DVDYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DVDYZ)) THEN
    SELF%DVDYZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DWDXZ)) THEN
    IF ((.NOT. SELF%F_DWDXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DWDXZ))) THEN
      SELF%DWDXZ => SELF%F_DWDXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DWDXZ)) THEN
    SELF%DWDXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DWDYZ)) THEN
    IF ((.NOT. SELF%F_DWDYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DWDYZ))) THEN
      SELF%DWDYZ => SELF%F_DWDYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DWDYZ)) THEN
    SELF%DWDYZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DRVDXZ)) THEN
    IF ((.NOT. SELF%F_DRVDXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DRVDXZ))) THEN
      SELF%DRVDXZ => SELF%F_DRVDXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DRVDXZ)) THEN
    SELF%DRVDXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DRVDYZ)) THEN
    IF ((.NOT. SELF%F_DRVDYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DRVDYZ))) THEN
      SELF%DRVDYZ => SELF%F_DRVDYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DRVDYZ)) THEN
    SELF%DRVDYZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DRLDXZ)) THEN
    IF ((.NOT. SELF%F_DRLDXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DRLDXZ))) THEN
      SELF%DRLDXZ => SELF%F_DRLDXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DRLDXZ)) THEN
    SELF%DRLDXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DRLDYZ)) THEN
    IF ((.NOT. SELF%F_DRLDYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DRLDYZ))) THEN
      SELF%DRLDYZ => SELF%F_DRLDYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DRLDYZ)) THEN
    SELF%DRLDYZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DRIDXZ)) THEN
    IF ((.NOT. SELF%F_DRIDXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DRIDXZ))) THEN
      SELF%DRIDXZ => SELF%F_DRIDXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DRIDXZ)) THEN
    SELF%DRIDXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DRIDYZ)) THEN
    IF ((.NOT. SELF%F_DRIDYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DRIDYZ))) THEN
      SELF%DRIDYZ => SELF%F_DRIDYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DRIDYZ)) THEN
    SELF%DRIDYZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DTHETADXZ)) THEN
    IF ((.NOT. SELF%F_DTHETADXZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DTHETADXZ))) THEN
      SELF%DTHETADXZ => SELF%F_DTHETADXZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DTHETADXZ)) THEN
    SELF%DTHETADXZ => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DTHETADYZ)) THEN
    IF ((.NOT. SELF%F_DTHETADYZ%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DTHETADYZ))) THEN
      SELF%DTHETADYZ => SELF%F_DTHETADYZ%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DTHETADYZ)) THEN
    SELF%DTHETADYZ => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%DUDX)) SELF%DUDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DUDY)) SELF%DUDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DVDX)) SELF%DVDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DVDY)) SELF%DVDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DTDX)) SELF%DTDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DTDY)) SELF%DTDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQVDX)) SELF%DQVDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQVDY)) SELF%DQVDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQLDX)) SELF%DQLDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQLDY)) SELF%DQLDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQIDX)) SELF%DQIDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQIDY)) SELF%DQIDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQRDX)) SELF%DQRDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQRDY)) SELF%DQRDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQSDX)) SELF%DQSDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQSDY)) SELF%DQSDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQGDX)) SELF%DQGDX => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DQGDY)) SELF%DQGDY => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DU2DX2)) SELF%DU2DX2 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DU2DY2)) SELF%DU2DY2 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DV2DX2)) SELF%DV2DX2 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DV2DY2)) SELF%DV2DY2 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DUDXZ)) SELF%DUDXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DUDYZ)) SELF%DUDYZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DVDXZ)) SELF%DVDXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DVDYZ)) SELF%DVDYZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DWDXZ)) SELF%DWDXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DWDYZ)) SELF%DWDYZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DRVDXZ)) SELF%DRVDXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DRVDYZ)) SELF%DRVDYZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DRLDXZ)) SELF%DRLDXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DRLDYZ)) SELF%DRLDYZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DRIDXZ)) SELF%DRIDXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DRIDYZ)) SELF%DRIDYZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DTHETADXZ)) SELF%DTHETADXZ => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DTHETADYZ)) SELF%DTHETADYZ => ZDUM2

ENDIF

END SUBROUTINE GRADIENT_TYPE_UPDATE_VIEW

SUBROUTINE GRADIENT_TYPE_FINAL (SELF)
CLASS (GRADIENT_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DTHETADYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DTHETADYZ) 
  SELF%F_DTHETADYZ => NULL ()
  SELF%DTHETADYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DTHETADXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DTHETADXZ) 
  SELF%F_DTHETADXZ => NULL ()
  SELF%DTHETADXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DRIDYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DRIDYZ) 
  SELF%F_DRIDYZ => NULL ()
  SELF%DRIDYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DRIDXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DRIDXZ) 
  SELF%F_DRIDXZ => NULL ()
  SELF%DRIDXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DRLDYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DRLDYZ) 
  SELF%F_DRLDYZ => NULL ()
  SELF%DRLDYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DRLDXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DRLDXZ) 
  SELF%F_DRLDXZ => NULL ()
  SELF%DRLDXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DRVDYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DRVDYZ) 
  SELF%F_DRVDYZ => NULL ()
  SELF%DRVDYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DRVDXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DRVDXZ) 
  SELF%F_DRVDXZ => NULL ()
  SELF%DRVDXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DWDYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DWDYZ) 
  SELF%F_DWDYZ => NULL ()
  SELF%DWDYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DWDXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DWDXZ) 
  SELF%F_DWDXZ => NULL ()
  SELF%DWDXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DVDYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DVDYZ) 
  SELF%F_DVDYZ => NULL ()
  SELF%DVDYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DVDXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DVDXZ) 
  SELF%F_DVDXZ => NULL ()
  SELF%DVDXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DUDYZ)) THEN
  CALL FIELD_DELETE (SELF%F_DUDYZ) 
  SELF%F_DUDYZ => NULL ()
  SELF%DUDYZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DUDXZ)) THEN
  CALL FIELD_DELETE (SELF%F_DUDXZ) 
  SELF%F_DUDXZ => NULL ()
  SELF%DUDXZ => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DV2DY2)) THEN
  CALL FIELD_DELETE (SELF%F_DV2DY2) 
  SELF%F_DV2DY2 => NULL ()
  SELF%DV2DY2 => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DV2DX2)) THEN
  CALL FIELD_DELETE (SELF%F_DV2DX2) 
  SELF%F_DV2DX2 => NULL ()
  SELF%DV2DX2 => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DU2DY2)) THEN
  CALL FIELD_DELETE (SELF%F_DU2DY2) 
  SELF%F_DU2DY2 => NULL ()
  SELF%DU2DY2 => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DU2DX2)) THEN
  CALL FIELD_DELETE (SELF%F_DU2DX2) 
  SELF%F_DU2DX2 => NULL ()
  SELF%DU2DX2 => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQGDY)) THEN
  CALL FIELD_DELETE (SELF%F_DQGDY) 
  SELF%F_DQGDY => NULL ()
  SELF%DQGDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQGDX)) THEN
  CALL FIELD_DELETE (SELF%F_DQGDX) 
  SELF%F_DQGDX => NULL ()
  SELF%DQGDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQSDY)) THEN
  CALL FIELD_DELETE (SELF%F_DQSDY) 
  SELF%F_DQSDY => NULL ()
  SELF%DQSDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQSDX)) THEN
  CALL FIELD_DELETE (SELF%F_DQSDX) 
  SELF%F_DQSDX => NULL ()
  SELF%DQSDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQRDY)) THEN
  CALL FIELD_DELETE (SELF%F_DQRDY) 
  SELF%F_DQRDY => NULL ()
  SELF%DQRDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQRDX)) THEN
  CALL FIELD_DELETE (SELF%F_DQRDX) 
  SELF%F_DQRDX => NULL ()
  SELF%DQRDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQIDY)) THEN
  CALL FIELD_DELETE (SELF%F_DQIDY) 
  SELF%F_DQIDY => NULL ()
  SELF%DQIDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQIDX)) THEN
  CALL FIELD_DELETE (SELF%F_DQIDX) 
  SELF%F_DQIDX => NULL ()
  SELF%DQIDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQLDY)) THEN
  CALL FIELD_DELETE (SELF%F_DQLDY) 
  SELF%F_DQLDY => NULL ()
  SELF%DQLDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQLDX)) THEN
  CALL FIELD_DELETE (SELF%F_DQLDX) 
  SELF%F_DQLDX => NULL ()
  SELF%DQLDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQVDY)) THEN
  CALL FIELD_DELETE (SELF%F_DQVDY) 
  SELF%F_DQVDY => NULL ()
  SELF%DQVDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DQVDX)) THEN
  CALL FIELD_DELETE (SELF%F_DQVDX) 
  SELF%F_DQVDX => NULL ()
  SELF%DQVDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DTDY)) THEN
  CALL FIELD_DELETE (SELF%F_DTDY) 
  SELF%F_DTDY => NULL ()
  SELF%DTDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DTDX)) THEN
  CALL FIELD_DELETE (SELF%F_DTDX) 
  SELF%F_DTDX => NULL ()
  SELF%DTDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DVDY)) THEN
  CALL FIELD_DELETE (SELF%F_DVDY) 
  SELF%F_DVDY => NULL ()
  SELF%DVDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DVDX)) THEN
  CALL FIELD_DELETE (SELF%F_DVDX) 
  SELF%F_DVDX => NULL ()
  SELF%DVDX => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DUDY)) THEN
  CALL FIELD_DELETE (SELF%F_DUDY) 
  SELF%F_DUDY => NULL ()
  SELF%DUDY => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DUDX)) THEN
  CALL FIELD_DELETE (SELF%F_DUDX) 
  SELF%F_DUDX => NULL ()
  SELF%DUDX => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE GRADIENT_TYPE_FINAL

END MODULE YOMDGRADIENT_TYPE_MOD

