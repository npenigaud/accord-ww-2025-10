SUBROUTINE APL_ARPEGE_INIT_OUTLINE_004 (YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS&
&, YDMF_PHYS_BASE_STATE, PPOID, PQI, PQL, PQR, PQS, PQV, PIPOI)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
REAL (KIND=JPRB), INTENT (OUT)::PPOID (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PQI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PQL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PQR (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PQS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PQV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PIPOI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPRB)::ZDQC
REAL (KIND=JPRB)::ZDQI
REAL (KIND=JPRB)::ZDQL
REAL (KIND=JPRB)::ZDQR
REAL (KIND=JPRB)::ZDQS
REAL (KIND=JPRB)::ZDQV
REAL (KIND=JPRB)::ZQV0
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_INIT_OUTLINE_004', 0, ZHOOK_HANDLE)

DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PQI (JLON, JLEV)=MAX (0.0_JPRB, YDMF_PHYS_BASE_STATE%I (JLON, JLEV))
    PQL (JLON, JLEV)=MAX (0.0_JPRB, YDMF_PHYS_BASE_STATE%L (JLON, JLEV))
    PQR (JLON, JLEV)=MAX (0.0_JPRB, YDMF_PHYS_BASE_STATE%R (JLON, JLEV))
    PQS (JLON, JLEV)=MAX (0.0_JPRB, YDMF_PHYS_BASE_STATE%S (JLON, JLEV))
    ZDQI=PQI (JLON, JLEV)-YDMF_PHYS_BASE_STATE%I (JLON, JLEV)
    ZDQL=PQL (JLON, JLEV)-YDMF_PHYS_BASE_STATE%L (JLON, JLEV)
    ZDQR=PQR (JLON, JLEV)-YDMF_PHYS_BASE_STATE%R (JLON, JLEV)
    ZDQS=PQS (JLON, JLEV)-YDMF_PHYS_BASE_STATE%S (JLON, JLEV)
    ZDQC=ZDQI+ZDQL+ZDQR+ZDQS
    ZQV0=YDMF_PHYS_BASE_STATE%Q (JLON, JLEV)-PIPOI (JLON, JLEV)*(0.0_JPRB-YDMF_PHYS%OUT%FCQNG&
    & (JLON, JLEV-1)-YDMF_PHYS%OUT%FCQNNG (JLON, JLEV-1)-YDMF_PHYS%OUT%FCQLNG (JLON, JLEV&
    &-1)-YDMF_PHYS%OUT%FCQRNG (JLON, JLEV-1)-YDMF_PHYS%OUT%FCQSNG (JLON, JLEV-1))
    PQV (JLON, JLEV)=MAX (0.0_JPRB, ZQV0-ZDQC)
    ZDQV=MAX (0.0_JPRB, ZQV0-ZDQC)-YDMF_PHYS_BASE_STATE%Q (JLON, JLEV)
    YDMF_PHYS%OUT%FCQNG (JLON, JLEV)=YDMF_PHYS%OUT%FCQNG (JLON, JLEV-1)-ZDQV*PPOID (JLON, JLEV)
    YDMF_PHYS%OUT%FCQNNG (JLON, JLEV)=YDMF_PHYS%OUT%FCQNNG (JLON, JLEV-1)-ZDQI*PPOID (JLON, JLEV)
    YDMF_PHYS%OUT%FCQLNG (JLON, JLEV)=YDMF_PHYS%OUT%FCQLNG (JLON, JLEV-1)-ZDQL*PPOID (JLON, JLEV)
    YDMF_PHYS%OUT%FCQRNG (JLON, JLEV)=YDMF_PHYS%OUT%FCQRNG (JLON, JLEV-1)-ZDQR*PPOID (JLON, JLEV)
    YDMF_PHYS%OUT%FCQSNG (JLON, JLEV)=YDMF_PHYS%OUT%FCQSNG (JLON, JLEV-1)-ZDQS*PPOID (JLON, JLEV)
  ENDDO

ENDDO

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_INIT_OUTLINE_004', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
