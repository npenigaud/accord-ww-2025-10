SUBROUTINE ARP_SHALLOW_MF_INIT (YDCPG_BNDS, YDCPG_OPTS, YDCST, YDMF_PHYS_SURF, PINVG&
&, KNLAB, PAPRSF, PDELP, PMF_UP, PQI, PQL, PQLI, PQR, PQS, PQV, PR, PT, PZZ, PZZF, PDPSG&
&, PDRTDT_MF, PDTHLDT_MF, PDUDT_MF, PDVDT_MF, PDZZ, PEMF, PEXNER, PFLXZTHMF, PFLXZTHVMF&
&, PFLXZUMF, PFLXZVMF, PFRAC_UP, PHRODJ, PHRODREF, PQDM, PRC_UP, PRI_UP, PRM, PRT_UP&
&, PRV_UP, PSFRV, PSFTH, PSVM, PTHETA, PTHL_UP, PU_UP, PW_UP, ZZZ)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE YOMCST,ONLY:TCST
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (TCST), INTENT (IN)::YDCST
TYPE (MF_PHYS_SURF_TYPE), INTENT (IN)::YDMF_PHYS_SURF
REAL (KIND=JPRB), INTENT (INOUT)::PINVG
INTEGER (KIND=JPIM), INTENT (OUT)::KNLAB (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PAPRSF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PDELP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PMF_UP (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PQLI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQR (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PR (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PZZ (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PZZF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDPSG (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDRTDT_MF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDTHLDT_MF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDUDT_MF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDVDT_MF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDZZ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PEMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PEXNER (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFLXZTHMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFLXZTHVMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFLXZUMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFLXZVMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFRAC_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PHRODJ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PHRODREF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PQDM (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRC_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRI_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRM (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, 5)
REAL (KIND=JPRB), INTENT (INOUT)::PRT_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRV_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PSFRV (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PSFTH (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PSVM (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, 1)
REAL (KIND=JPRB), INTENT (INOUT)::PTHETA (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PTHL_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PU_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PW_UP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::ZZZ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPRB)::ZHRO (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZZZF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_INIT', 0, ZHOOK_HANDLE)

DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    ZZZ (JLON, JLEV)=PZZ (JLON, JLEV)*PINVG
    ZZZF (JLON, JLEV)=PZZF (JLON, JLEV)*PINVG
  ENDDO

ENDDO


DO JLEV=2, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PDZZ (JLON, JLEV)=ZZZF (JLON, JLEV-1)-ZZZF (JLON, JLEV)
  ENDDO

ENDDO


DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  PDZZ (JLON, 1)=PDZZ (JLON, 2)
ENDDO


DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PEXNER (JLON, JLEV)=(PAPRSF (JLON, JLEV)/YDCST%RATM)**YDCST%RKAPPA
    PTHETA (JLON, JLEV)=PT (JLON, JLEV)/PEXNER (JLON, JLEV)
    ZHRO (JLON, JLEV)=PAPRSF (JLON, JLEV)/(PT (JLON, JLEV)*PR (JLON, JLEV))
    PQDM (JLON, JLEV)=(1.-PQV (JLON, JLEV)-PQL (JLON, JLEV)&
    &-PQI (JLON, JLEV)-PQR (JLON, JLEV)-PQS (JLON, JLEV))
    PHRODREF (JLON, JLEV)=ZHRO (JLON, JLEV)*PQDM (JLON, JLEV)
    PHRODJ (JLON, JLEV)=PDELP (JLON, JLEV)*PINVG
    PRM (JLON, JLEV, 1)=PQV (JLON, JLEV)/PQDM (JLON, JLEV)
    PRM (JLON, JLEV, 2)=PQL (JLON, JLEV)/PQDM (JLON, JLEV)
    PRM (JLON, JLEV, 3)=PQR (JLON, JLEV)/PQDM (JLON, JLEV)
    PRM (JLON, JLEV, 4)=PQI (JLON, JLEV)/PQDM (JLON, JLEV)
    PRM (JLON, JLEV, 5)=PQS (JLON, JLEV)/PQDM (JLON, JLEV)
    PDPSG (JLON, JLEV)=MAX (1.E-15, PDELP (JLON, JLEV)/YDCST%RG)
  ENDDO

ENDDO

PSVM (:,:,:)=0.

DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  PSFTH (JLON)=-YDMF_PHYS_SURF%GSD_SFL%PGROUP (JLON, 1)/ZHRO (JLON, YDCPG_OPTS%KFLEVG)/YDCST%RCPD
  PSFRV (JLON)=-YDMF_PHYS_SURF%GSD_SFL%PGROUP (JLON, 2)/ZHRO (JLON, YDCPG_OPTS%KFLEVG)
ENDDO

PDUDT_MF (:,:)=0._JPRB
PDVDT_MF (:,:)=0._JPRB
PDTHLDT_MF (:,:)=0._JPRB
PDRTDT_MF (:,:)=0._JPRB
PMF_UP (:,:)=0._JPRB
PEMF (:,:)=0._JPRB
PQLI (:,:)=0._JPRB
KNLAB (:,:)=0
PRC_UP (:,:)=0._JPRB
PRI_UP (:,:)=0._JPRB
PRT_UP (:,:)=0._JPRB
PFLXZTHVMF (:,:)=0._JPRB
PFLXZTHMF (:,:)=0._JPRB
PFLXZTHMF (:,:)=0._JPRB
PFLXZUMF (:,:)=0._JPRB
PFLXZVMF (:,:)=0._JPRB
PTHL_UP (:,:)=0._JPRB
PRV_UP (:,:)=0._JPRB
PU_UP (:,:)=0._JPRB
PW_UP (:,:)=0._JPRB
PFRAC_UP (:,:)=0._JPRB
IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_INIT', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
