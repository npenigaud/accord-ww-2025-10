SUBROUTINE MF_PHYS_PREP_PREP (YDARPHY, YDCPG_BNDS, YDCPG_DYN0, YDCPG_DYN9&
&, YDCPG_PHY0, YDCPG_PHY9, YDDYNA, YDGEOMETRY, PUSG)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_TYPE_MOD,ONLY:CPG_DYN_TYPE, CPG_PHY_TYPE
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE PARKIND1,ONLY:JPIM, JPRB
USE YOMARPHY,ONLY:TARPHY
USE YOMDYNA,ONLY:TDYNA
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

TYPE (TARPHY), INTENT (IN)::YDARPHY
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_DYN_TYPE), INTENT (IN)::YDCPG_DYN0
TYPE (CPG_DYN_TYPE), INTENT (IN)::YDCPG_DYN9
TYPE (CPG_PHY_TYPE), INTENT (INOUT)::YDCPG_PHY0
TYPE (CPG_PHY_TYPE), INTENT (INOUT)::YDCPG_PHY9
TYPE (TDYNA), INTENT (IN)::YDDYNA
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
REAL (KIND=JPRB), INTENT (INOUT)::PUSG
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('MF_PHYS_PREP_PREP', 0, ZHOOK_HANDLE)

DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    YDCPG_PHY0%W (JLON, JLEV)=YDCPG_DYN0%GWFT (JLON, JLEV)*PUSG
  ENDDO

ENDDO


IF (YDARPHY%LMPA.AND.(.NOT.YDDYNA%LTWOTL)) THEN

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      YDCPG_PHY9%W (JLON, JLEV)=YDCPG_DYN9%GWFT (JLON, JLEV)*PUSG
    ENDDO

  ENDDO

ELSEIF (.NOT.YDDYNA%LTWOTL) THEN
  YDCPG_PHY9%W (:,:)=0.0_JPRB
ENDIF


IF (YDDYNA%LNHDYN) THEN

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      YDCPG_PHY0%WL (JLON, JLEV)=YDCPG_DYN0%GWFL (JLON, JLEV)*PUSG
      YDCPG_PHY0%WM (JLON, JLEV)=YDCPG_DYN0%GWFM (JLON, JLEV)*PUSG
    ENDDO

  ENDDO

ELSE
  YDCPG_PHY0%WL (:,:)=0.0_JPRB
  YDCPG_PHY0%WM (:,:)=0.0_JPRB
ENDIF

YDCPG_PHY0%PREF (:,:)=0.0_JPRB
YDCPG_PHY0%PRE (:,:)=0.0_JPRB

IF (.NOT.YDDYNA%LTWOTL) THEN
  YDCPG_PHY9%PREF (:,:)=0.0_JPRB
  YDCPG_PHY9%PRE (:,:)=0.0_JPRB
ENDIF


IF (YDARPHY%LMPA) THEN

  IF (YDDYNA%LNHDYN.AND.YDDYNA%LTWOTL) THEN
    YDCPG_PHY0%PREF (:,:)=YDCPG_DYN0%NHPREF (:,:)
    YDCPG_PHY0%PRE (:,:)=YDCPG_DYN0%NHPREH (:,:)
  ELSEIF (YDDYNA%LNHDYN.AND.(.NOT.YDDYNA%LTWOTL)) THEN
    YDCPG_PHY9%PREF (:,:)=YDCPG_DYN9%NHPREF (:,:)
    YDCPG_PHY9%PRE (:,:)=YDCPG_DYN9%NHPREH (:,:)
  ELSEIF ((.NOT.YDDYNA%LNHDYN).AND.YDDYNA%LTWOTL) THEN
    YDCPG_PHY0%PREF (:,:)=YDCPG_DYN0%PREF (:,:)
    YDCPG_PHY0%PRE (:,:)=YDCPG_DYN0%PRE (:,:)
  ELSEIF ((.NOT.YDDYNA%LNHDYN).AND.(.NOT.YDDYNA%LTWOTL)) THEN
    YDCPG_PHY9%PREF (:,:)=YDCPG_DYN9%PREF (:,:)
    YDCPG_PHY9%PRE (:,:)=YDCPG_DYN9%PRE (:,:)
  ENDIF

ENDIF

YDCPG_PHY0%PREHYDF (:,:)=YDCPG_DYN0%PREF (:,:)
YDCPG_PHY0%PREHYD (:,:)=YDCPG_DYN0%PRE (:,:)
YDCPG_PHY0%XYB%DELP (:,:)=YDCPG_DYN0%XYB%DELP (:,:)
YDCPG_PHY0%XYB%RDELP (:,:)=YDCPG_DYN0%XYB%RDELP (:,:)
YDCPG_PHY0%XYB%LNPR (:,:)=YDCPG_DYN0%XYB%LNPR (:,:)
YDCPG_PHY0%XYB%ALPH (:,:)=YDCPG_DYN0%XYB%ALPH (:,:)

IF (.NOT.YDDYNA%LTWOTL) THEN
  YDCPG_PHY9%PREHYDF (:,:)=YDCPG_DYN9%PREF (:,:)
  YDCPG_PHY9%PREHYD (:,:)=YDCPG_DYN9%PRE (:,:)
  YDCPG_PHY9%XYB%DELP (:,:)=YDCPG_DYN9%XYB%DELP (:,:)
  YDCPG_PHY9%XYB%RDELP (:,:)=YDCPG_DYN9%XYB%RDELP (:,:)
  YDCPG_PHY9%XYB%LNPR (:,:)=YDCPG_DYN9%XYB%LNPR (:,:)
  YDCPG_PHY9%XYB%ALPH (:,:)=YDCPG_DYN9%XYB%ALPH (:,:)
ENDIF

IF (LHOOK) CALL DR_HOOK ('MF_PHYS_PREP_PREP', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
