SUBROUTINE APL_ARPEGE_DPRECIPS_OUTLINE_000 (YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, YDMF_PHYS_BASE_STATE&
&, YDMODEL, YDVARS, PINVG, PPRC_DPRECIPS, PPRC_DPRECIPS2)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE TYPE_MODEL,ONLY:MODEL
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (MODEL), INTENT (IN)::YDMODEL
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
REAL (KIND=JPRB), INTENT (INOUT)::PINVG
REAL (KIND=JPRB), INTENT (OUT)::PPRC_DPRECIPS (YDCPG_OPTS%KLON, 1:YDCPG_OPTS%NDTPREC)
REAL (KIND=JPRB), INTENT (OUT)::PPRC_DPRECIPS2 (YDCPG_OPTS%KLON, 1:YDCPG_OPTS%NDTPREC2)
#include "dprecips.intfb.h"
#include "ppwetpoint.intfb.h"
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPRB)::ZDZZ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZFPLC (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZFPLS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZFPLSG (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZTW (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZZZ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_OUTLINE_000', 0, ZHOOK_HANDLE)
CALL PPWETPOINT (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY, YDCPG_BNDS%KIDIA, YDCPG_BNDS&
&%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDMF_PHYS_BASE_STATE%YCPG_PHY%PREHYDF&
& (:,:), YDMF_PHYS_BASE_STATE%T (:,:), YDMF_PHYS_BASE_STATE%Q (:,:), YDMF_PHYS_BASE_STATE&
&%L (:,:), YDMF_PHYS_BASE_STATE%I (:,:), ZTW (:,:))

DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  ZFPLS (JLON)=YDMF_PHYS%OUT%FPLCN (JLON, YDCPG_OPTS%KFLEVG&
  &)+YDMF_PHYS%OUT%FPLSN (JLON, YDCPG_OPTS%KFLEVG)
  ZFPLC (JLON)=YDMF_PHYS%OUT%FPLCL (JLON, YDCPG_OPTS%KFLEVG&
  &)+YDMF_PHYS%OUT%FPLSL (JLON, YDCPG_OPTS%KFLEVG)
  ZFPLSG (JLON)=0._JPRB
ENDDO


DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    ZZZ (JLON, JLEV)=YDMF_PHYS_BASE_STATE%YCPG_DYN%PHI (JLON, JLEV)*PINVG
  ENDDO

ENDDO


DO JLEV=2, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    ZDZZ (JLON, JLEV)=ZZZ (JLON, JLEV-1)-ZZZ (JLON, JLEV)
  ENDDO

ENDDO


DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  ZDZZ (JLON, 1)=YDMF_PHYS_BASE_STATE%YCPG_DYN%PHI (JLON, 0)*PINVG-ZZZ (JLON, 1)
ENDDO

CALL DPRECIPS (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YDCPG_BNDS%KIDIA, YDCPG_BNDS&
&%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDVARS%GEOMETRY%OROG%T0, YDMF_PHYS%OUT%TPWCLS&
&, YDMF_PHYS%OUT%DIAGH, YDMF_PHYS_BASE_STATE%YCPG_DYN%PHIF, ZDZZ, ZTW, YDMF_PHYS_BASE_STATE&
&%L, ZFPLC, ZFPLS, ZFPLSG, PPRC_DPRECIPS (:, YDCPG_OPTS%NDTPRECCUR))
CALL DPRECIPS (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YDCPG_BNDS%KIDIA, YDCPG_BNDS&
&%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDVARS%GEOMETRY%OROG%T0, YDMF_PHYS%OUT%TPWCLS&
&, YDMF_PHYS%OUT%DIAGH, YDMF_PHYS_BASE_STATE%YCPG_DYN%PHIF, ZDZZ, ZTW, YDMF_PHYS_BASE_STATE&
&%L, ZFPLC, ZFPLS, ZFPLSG, PPRC_DPRECIPS2 (:, YDCPG_OPTS%NDTPRECCUR2))
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_OUTLINE_000', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
