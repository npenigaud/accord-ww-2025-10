SUBROUTINE APL_ARPEGE_ALBEDO_COMPUTATION_OUTLINE_000 (PEPS0, YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, YDMF_PHYS_BASE_STATE&
&, YDMF_PHYS_SURF, YDMODEL, PALBD, PALBDIR, PALBP, PFLU_EMIS, PFLU_NEIJ, PRDG_MU0)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE TYPE_MODEL,ONLY:MODEL
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

REAL (KIND=JPRB), INTENT (IN)::PEPS0
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (MF_PHYS_SURF_TYPE), INTENT (INOUT)::YDMF_PHYS_SURF
TYPE (MODEL), INTENT (IN)::YDMODEL
REAL (KIND=JPRB), INTENT (OUT)::PALBD (YDCPG_OPTS%KLON, YDCPG_OPTS%KSW)
REAL (KIND=JPRB), INTENT (OUT)::PALBDIR (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (OUT)::PALBP (YDCPG_OPTS%KLON, YDCPG_OPTS%KSW)
REAL (KIND=JPRB), INTENT (OUT)::PFLU_EMIS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (IN)::PFLU_NEIJ (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (IN)::PRDG_MU0 (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JSG
REAL (KIND=JPRB)::ZLAMB
REAL (KIND=JPRB)::ZMERL (YDCPG_OPTS%KLON)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_ALBEDO_COMPUTATION_OUTLINE_000', 0, ZHOOK_HANDLE)

DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  YDMF_PHYS%OUT%ALB (JLON)=YDMF_PHYS_SURF%GSD_VF%PALBF (JLON)-PFLU_NEIJ (JLON)*(YDMF_PHYS_SURF%GSD_VF&
  &%PALBF (JLON)-MAX (YDMF_PHYS_SURF%GSD_VF%PALBF (JLON), YDMODEL%YRML_PHY_MF%YRPHY1%ALCRIN))
  PFLU_EMIS (JLON)=YDMF_PHYS_SURF%GSD_VF%PEMISF (JLON)-PFLU_NEIJ (JLON)*(YDMF_PHYS_SURF&
  &%GSD_VF%PEMISF (JLON)-YDMODEL%YRML_PHY_MF%YRPHY1%EMCRIN)
ENDDO


IF (YDMODEL%YRML_PHY_MF%YRPHY%LRAYFM) THEN

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    ZMERL (JLON)=(1.0_JPRB-YDMF_PHYS_SURF%GSD_VF%PLSM (JLON))*(1.0_JPRB-MAX (0.0_JPRB, SIGN &
    &(1.0_JPRB, YDMODEL%YRML_PHY_MF%YRPHY1%TMERGL-YDMF_PHYS_BASE_STATE%YGSP_RR%T (JLON))))
    PFLU_EMIS (JLON)=PFLU_EMIS (JLON)*YDMF_PHYS_SURF%GSD_VF%PLSM (JLON)+ZMERL &
    &(JLON)*YDMODEL%YRML_PHY_MF%YRPHY1%EMMMER+(1.0_JPRB-YDMF_PHYS_SURF%GSD_VF%PLSM&
    & (JLON))*(1.0_JPRB-ZMERL (JLON))*YDMODEL%YRML_PHY_MF%YRPHY1%EMMGLA
  ENDDO


  DO JSG=1, YDMODEL%YRML_PHY_RAD%YRERAD%NSW

    DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      PALBD (JLON, JSG)=(1.0_JPRB-ZMERL (JLON))*YDMF_PHYS%OUT%ALB&
      & (JLON)+ZMERL (JLON)*YDMODEL%YRML_PHY_MF%YRPHY1%ALBMED
      PALBP (JLON, JSG)=(1.0_JPRB-ZMERL (JLON))*YDMF_PHYS%OUT%ALB (JLON)+ZMERL (JLON&
      &)*MAX (0.037_JPRB/(1.1_JPRB*PRDG_MU0 (JLON)**1.4_JPRB+0.15_JPRB), PEPS0)
    ENDDO

  ENDDO

ELSEIF (YDMODEL%YRML_PHY_MF%YRPHY%LRAY) THEN

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA

    IF (YDMF_PHYS_SURF%GSD_VF%PLSM (JLON)<0.5_JPRB.AND.YDMF_PHYS_BASE_STATE&
      &%YGSP_RR%T (JLON)>=YDMODEL%YRML_PHY_MF%YRPHY1%TMERGL) THEN
      ZLAMB=YDMODEL%YRML_PHY_MF%YRPHY3%RLAMB_WATER
    ELSE
      ZLAMB=YDMODEL%YRML_PHY_MF%YRPHY3%RLAMB_SOLID
    ENDIF

    PALBDIR (JLON)=ZLAMB*YDMF_PHYS%OUT%ALB (JLON)+(1._JPRB-ZLAMB)*(1._JPRB+0.5_JPRB&
    &*PRDG_MU0 (JLON)*(1.0_JPRB/YDMF_PHYS%OUT%ALB (JLON)-1.0_JPRB))/(1.0_JPRB+PRDG_MU0&
    & (JLON)*(1.0_JPRB/YDMF_PHYS%OUT%ALB (JLON)-1.0_JPRB))**2
  ENDDO

ENDIF

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_ALBEDO_COMPUTATION_OUTLINE_000', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
