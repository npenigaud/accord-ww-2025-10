SUBROUTINE CUBASMCN_OPENACC (YDCST, YDECUMF, KIDIA, KFDIA, KLON, KLEV, KK,&
& PTEN, PQEN, PQSEN, PVERVEL, PGEO, PGEOH, LDCUM, KTYPE, KLAB, KCBOT, PMFU&
&, PMFUB, PLRAIN, PTU, PQU, PLU, PMFUS, PMFUQ, PMFUL, PDMFUP, YDSTACK)
!$ACC ROUTINE (CUBASMCN_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOECUMF,ONLY:TECUMF
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (TECUMF), INTENT (IN)::YDECUMF
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KK
REAL (KIND=JPRB), INTENT (IN)::PTEN 
REAL (KIND=JPRB), INTENT (IN)::PQEN 
REAL (KIND=JPRB), INTENT (IN)::PQSEN 
REAL (KIND=JPRB), INTENT (IN)::PVERVEL 
REAL (KIND=JPRB), INTENT (IN)::PGEO 
REAL (KIND=JPRB), INTENT (IN)::PGEOH 
LOGICAL, INTENT (IN)::LDCUM 
INTEGER (KIND=JPIM), INTENT (OUT)::KTYPE 
INTEGER (KIND=JPIM), INTENT (INOUT)::KLAB 
INTEGER (KIND=JPIM), INTENT (OUT)::KCBOT 
REAL (KIND=JPRB), INTENT (OUT)::PMFU 
REAL (KIND=JPRB), INTENT (OUT)::PMFUB 
REAL (KIND=JPRB), INTENT (OUT)::PLRAIN 
REAL (KIND=JPRB), INTENT (OUT)::PTU 
REAL (KIND=JPRB), INTENT (OUT)::PQU 
REAL (KIND=JPRB), INTENT (OUT)::PLU 
REAL (KIND=JPRB), INTENT (OUT)::PMFUS 
REAL (KIND=JPRB), INTENT (OUT)::PMFUQ 
REAL (KIND=JPRB), INTENT (OUT)::PMFUL 
REAL (KIND=JPRB), INTENT (OUT)::PDMFUP 
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK

fxtran_acdc_temp (REAL(KIND=JPRB), PTEN_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PQEN_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PQSEN_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PVERVEL_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PGEO_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PGEOH_PTR, (KLON, KLEV+1))
fxtran_acdc_temp (LOGICAL, LDCUM_PTR, (KLON))
fxtran_acdc_temp (INTEGER(KIND=JPIM), KTYPE_PTR, (KLON))
fxtran_acdc_temp (INTEGER(KIND=JPIM), KLAB_PTR, (KLON, KLEV))
fxtran_acdc_temp (INTEGER(KIND=JPIM), KCBOT_PTR, (KLON))
fxtran_acdc_temp (REAL(KIND=JPRB), PMFU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PMFUB_PTR, (KLON))
fxtran_acdc_temp (REAL(KIND=JPRB), PLRAIN_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PTU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PQU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PLU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PMFUS_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PMFUQ_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PMFUL_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PDMFUP_PTR, (KLON, KLEV))

INTEGER (KIND=JPIM)::JL
REAL (KIND=JPRB)::ZORCPD
REAL (KIND=JPRB)::ZRG
REAL (KIND=JPRB)::ZZZMB


fxtran_acdc_assoc (PTEN_PTR, PTEN)

fxtran_acdc_assoc (PQEN_PTR, PQEN)

fxtran_acdc_assoc (PQSEN_PTR, PQSEN)

fxtran_acdc_assoc (PVERVEL_PTR, PVERVEL)

fxtran_acdc_assoc (PGEO_PTR, PGEO)

fxtran_acdc_assoc (PGEOH_PTR, PGEOH)

fxtran_acdc_assoc (LDCUM_PTR, LDCUM)

fxtran_acdc_assoc (KTYPE_PTR, KTYPE)

fxtran_acdc_assoc (KLAB_PTR, KLAB)

fxtran_acdc_assoc (KCBOT_PTR, KCBOT)

fxtran_acdc_assoc (PMFU_PTR, PMFU)

fxtran_acdc_assoc (PMFUB_PTR, PMFUB)

fxtran_acdc_assoc (PLRAIN_PTR, PLRAIN)

fxtran_acdc_assoc (PTU_PTR, PTU)

fxtran_acdc_assoc (PQU_PTR, PQU)

fxtran_acdc_assoc (PLU_PTR, PLU)

fxtran_acdc_assoc (PMFUS_PTR, PMFUS)

fxtran_acdc_assoc (PMFUQ_PTR, PMFUQ)

fxtran_acdc_assoc (PMFUL_PTR, PMFUL)

fxtran_acdc_assoc (PDMFUP_PTR, PDMFUP)

JL = KIDIA



ZRG=1.0_JPRB/YDCST%RG
ZORCPD=1.0_JPRB/YDCST%RCPD


IF (.NOT.LDCUM_PTR (JL).AND.KLAB_PTR (JL, KK+1)==0) THEN

  IF (YDECUMF%LMFMID.AND.KK>YDECUMF%NJKT7.AND.PQEN_PTR (JL, KK)>0.80_JPRB*PQSEN_PTR (JL, KK)) THEN
    PTU_PTR (JL, KK+1)=(YDCST%RCPD*PTEN_PTR (JL, KK)+PGEO_PTR (JL, KK)-PGEOH_PTR (JL, KK+1))*ZORCPD
    PQU_PTR (JL, KK+1)=PQEN_PTR (JL, KK)
    PLU_PTR (JL, KK+1)=0.0_JPRB
    ZZZMB=MAX (1.E-6_JPRB,-PVERVEL_PTR (JL, KK)*ZRG)
    ZZZMB=MIN (ZZZMB, YDECUMF%RMFLIA)
    PMFUB_PTR (JL)=ZZZMB
    PMFU_PTR (JL, KK+1)=PMFUB_PTR (JL)
    PMFUS_PTR (JL, KK+1)=PMFUB_PTR (JL)*(YDCST%RCPD*PTU_PTR (JL, KK+1)+PGEOH_PTR (JL, KK+1))
    PMFUQ_PTR (JL, KK+1)=PMFUB_PTR (JL)*PQU_PTR (JL, KK+1)
    PMFUL_PTR (JL, KK+1)=0.0_JPRB
    PDMFUP_PTR (JL, KK+1)=0.0_JPRB
    PLRAIN_PTR (JL, KK+1)=0.0_JPRB
    KCBOT_PTR (JL)=KK
    KLAB_PTR (JL, KK+1)=1
    KTYPE_PTR (JL)=3
  ENDIF

ENDIF




ENDSUBROUTINE CUBASMCN_OPENACC
