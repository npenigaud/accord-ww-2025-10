SUBROUTINE LATTES_OUTLINE_000 (LDCT, LDCTC, PDTS2, PESGM, PESGP, YDCPG_BNDS, YDCPG_OPTS&
&, YDCPG_SL1, YDCPG_SL2, YDGEOMETRY, YDML_DYN, YDRIP, YDVARS, PCMSLP, PXIDT0, PXIDT9&
&, PXIGP, PBDT, PMIXNL, POROGL, POROGM, PRES0, PSDIV0, PSDIV9, PSDVBC)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_SL1_TYPE_MOD,ONLY:CPG_SL1B_TYPE
USE CPG_SL2_TYPE_MOD,ONLY:CPG_SL2_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE PARKIND1,ONLY:JPIM, JPRB
USE MODEL_DYNAMICS_MOD,ONLY:MODEL_DYNAMICS_TYPE
USE YOMRIP,ONLY:TRIP
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

LOGICAL, INTENT (INOUT)::LDCT
LOGICAL, INTENT (INOUT)::LDCTC
REAL (KIND=JPRB), INTENT (IN)::PDTS2
REAL (KIND=JPRB), INTENT (IN)::PESGM
REAL (KIND=JPRB), INTENT (IN)::PESGP
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_SL1B_TYPE), INTENT (INOUT)::YDCPG_SL1
TYPE (CPG_SL2_TYPE), INTENT (INOUT)::YDCPG_SL2
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (MODEL_DYNAMICS_TYPE), INTENT (IN)::YDML_DYN
TYPE (TRIP), INTENT (IN)::YDRIP
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
REAL (KIND=JPRB), INTENT (INOUT)::PCMSLP
REAL (KIND=JPRB), INTENT (INOUT)::PXIDT0
REAL (KIND=JPRB), INTENT (INOUT)::PXIDT9
REAL (KIND=JPRB), INTENT (INOUT)::PXIGP
REAL (KIND=JPRB), INTENT (IN)::PBDT (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PMIXNL (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::POROGL (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::POROGM (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PRES0 (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PSDIV0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PSDIV9 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PSDVBC (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)
#include "verdisint.intfb.h"
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JROF
REAL (KIND=JPRB)::ZMIXNL
REAL (KIND=JPRB)::ZNESC
REAL (KIND=JPRB)::ZSETTLS
REAL (KIND=JPRB)::ZMOY1SP (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZMOYSPNL (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZSPNLT0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZSPNLT1 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZSPNLT_FE (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG+1)
REAL (KIND=JPRB)::ZSPT1 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZSPTB (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZVWEI (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('LATTES_OUTLINE_000', 0, ZHOOK_HANDLE)

DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  ZSPTB (JROF)=PSDVBC (JROF, YDGEOMETRY%YRDIMV%NFLEVG)/PRES0 (JROF, YDGEOMETRY%YRDIMV%NFLEVG)
ENDDO


DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
  ZVWEI (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)=YDGEOMETRY%YRVERT_GEOM%YRVAB%VDELB (JLEV)
ENDDO


DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  YDCPG_SL2%SPSI (JROF)=PBDT (JROF)*PSDIV0 (JROF)
  ZSPTB (JROF)=-PDTS2*ZSPTB (JROF)
ENDDO


DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

  DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    ZMOY1SP (JROF, JLEV)=PDTS2*(YDVARS%U%T0 (JROF, JLEV)*(YDVARS%SP%DL (JROF)+PCMSLP*POROGL&
    & (JROF))+YDVARS%V%T0 (JROF, JLEV)*(YDVARS%SP%DM (JROF)+PCMSLP*POROGM (JROF)))
  ENDDO


  DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    ZMOY1SP (JROF, JLEV)=ZMOY1SP (JROF, JLEV)+ZSPTB (JROF)
  ENDDO

ENDDO


IF (YDML_DYN%YRDYNA%LTWOTL) THEN

  IF (.NOT.LDCT) THEN

    DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        ZSPNLT0 (JROF)=ZMOY1SP (JROF, JLEV)+PXIDT0*YDCPG_SL2%SPSI (JROF)
      ENDDO


      IF (YDML_DYN%YRDYN%NVLAG==2.OR.YDML_DYN%YRDYN%NVLAG==3) THEN

        IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.YDML_DYN%YRDYNA%LNESC) THEN

          DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
            YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+PESGM*ZMOY1SP (JROF, JLEV)
          ENDDO


          IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              ZSPNLT_FE (JROF, JLEV)=ZSPNLT0 (JROF)*ZVWEI (JROF, JLEV)*YDGEOMETRY&
              &%YRVERT_GEOM%YRVETA%VFE_RDETAH (JLEV)*PESGP
            ENDDO

          ELSE

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+PESGP*ZVWEI (JROF, JLEV)*ZSPNLT0 (JROF)
            ENDDO

          ENDIF

        ELSEIF (YDML_DYN%YRDYNA%LSETTLS) THEN

          IF (YDML_DYN%YRDYNA%LPC_CHEAP) THEN

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              ZNESC=PESGM*ZMOY1SP (JROF, JLEV)
              ZSETTLS=ZSPNLT0 (JROF)-YDVARS%SPNL%T9 (JROF, JLEV)
              ZMIXNL=PMIXNL (JROF, JLEV)
              YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+ZNESC
              YDCPG_SL1%C9_NL%P (JROF, JLEV)=ZMIXNL*ZSETTLS
            ENDDO

          ELSE

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              ZNESC=PESGM*ZMOY1SP (JROF, JLEV)
              ZSETTLS=ZSPNLT0 (JROF)-YDVARS%SPNL%T9 (JROF, JLEV)
              ZMIXNL=PMIXNL (JROF, JLEV)
              YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+ZNESC+ZMIXNL*ZSETTLS
            ENDDO

          ENDIF


          IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              ZSPNLT_FE (JROF, JLEV)=ZSPNLT0 (JROF)*PESGP*ZVWEI (JROF, JLEV&
              &)*YDGEOMETRY%YRVERT_GEOM%YRVETA%VFE_RDETAH (JLEV)
            ENDDO

          ELSE

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+PESGP*ZVWEI (JROF, JLEV)*ZSPNLT0 (JROF)
            ENDDO

          ENDIF

        ELSE

          DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
            YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+PESGM*ZMOY1SP (JROF&
            &, JLEV)+0.5_JPRB*PESGM*(ZSPNLT0 (JROF)-YDVARS%SPNL%T9 (JROF, JLEV))
          ENDDO


          IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              ZSPNLT_FE (JROF, JLEV)=(1.5_JPRB*ZSPNLT0 (JROF)-0.5_JPRB*YDVARS%SPNL%T9 (JROF, JLEV&
              &))*ZVWEI (JROF, JLEV)*YDGEOMETRY%YRVERT_GEOM%YRVETA%VFE_RDETAH (JLEV)*PESGP
            ENDDO

          ELSE

            DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
              YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+PESGP*ZVWEI (JROF, JLEV)*&
              &(1.5_JPRB*ZSPNLT0 (JROF)-0.5_JPRB*YDVARS%SPNL%T9 (JROF, JLEV))
            ENDDO

          ENDIF

        ENDIF

      ENDIF


      IF (YDML_DYN%YRDYNA%LPC_FULL) THEN
        YDVARS%CSPNL%T9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV&
        &)=ZMOY1SP (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
      ENDIF


      IF (.NOT.YDML_DYN%YRDYNA%LNESC) THEN

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          YDVARS%SPNL%T9 (JROF, JLEV)=ZMOY1SP (JROF, JLEV)+PXIDT9*YDCPG_SL2%SPSI (JROF)
        ENDDO

      ENDIF

    ENDDO


    IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

      IF (YDML_DYN%YRDYN%NVLAG==2.OR.YDML_DYN%YRDYN%NVLAG==3) THEN
        ZSPNLT_FE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, 0)=0.0_JPRB
        ZSPNLT_FE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDGEOMETRY%YRDIMV%NFLEVG+1)=0.0_JPRB
        CALL VERDISINT (YDGEOMETRY%YRVERT_GEOM%YRVFE, YDGEOMETRY%YRVERT_GEOM%YRCVER,'ITOP','11', YDGEOMETRY%YRDIM&
        &%NPROMA, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, YDGEOMETRY%YRDIMV%NFLEVG, ZSPNLT_FE, POUTS=ZSPT1)

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+ZSPT1 (JROF)
        ENDDO

      ENDIF

    ENDIF


    IF (YDML_DYN%YRDYN%NVLAG==2.OR.YDML_DYN%YRDYN%NVLAG==3) THEN

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        YDCPG_SL1%SP9%P (JROF)=YDCPG_SL1%SP9%P (JROF)+YDVARS%SP&
        &%T0 (JROF)+PCMSLP*YDVARS%GEOMETRY%OROG%T0 (JROF)
        YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)-PCMSLP*YDVARS%GEOMETRY%OROG%T0 (JROF)
      ENDDO

    ENDIF

  ELSE

    DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        ZSPNLT1 (JROF)=ZMOY1SP (JROF, JLEV)+PXIDT9*YDCPG_SL2%SPSI (JROF)
      ENDDO


      IF (.NOT.LDCTC) THEN

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+PESGM*YDVARS%CSPNL%T9 (JROF, JLEV)
        ENDDO

      ENDIF


      IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          ZSPNLT_FE (JROF, JLEV)=ZSPNLT1 (JROF)*ZVWEI (JROF, JLEV)*YDGEOMETRY&
          &%YRVERT_GEOM%YRVETA%VFE_RDETAH (JLEV)*PESGP
        ENDDO

      ELSE

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+ZVWEI (JROF, JLEV)*ZSPNLT1 (JROF)*PESGP
        ENDDO

      ENDIF

    ENDDO


    IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN
      ZSPNLT_FE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, 0)=0.0_JPRB
      ZSPNLT_FE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDGEOMETRY%YRDIMV%NFLEVG+1)=0.0_JPRB
      CALL VERDISINT (YDGEOMETRY%YRVERT_GEOM%YRVFE, YDGEOMETRY%YRVERT_GEOM%YRCVER,'ITOP','11', YDGEOMETRY%YRDIM&
      &%NPROMA, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, YDGEOMETRY%YRDIMV%NFLEVG, ZSPNLT_FE, POUTS=ZSPT1)

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+ZSPT1 (JROF)
      ENDDO

    ENDIF


    IF (.NOT.LDCTC) THEN

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        YDCPG_SL1%SP9%P (JROF)=YDCPG_SL1%SP9%P (JROF)+YDVARS%SP&
        &%T9 (JROF)+PCMSLP*YDVARS%GEOMETRY%OROG%T0 (JROF)
      ENDDO

    ENDIF


    DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)-PCMSLP*YDVARS%GEOMETRY%OROG%T0 (JROF)
    ENDDO

  ENDIF


  IF (YDML_DYN%YRDYN%XIDT>0.0_JPRB) THEN

    DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)-PXIGP*YDCPG_SL2%SPSI (JROF)
      YDCPG_SL2%SPSI (JROF)=PXIGP*YDCPG_SL2%SPSI (JROF)
    ENDDO

  ELSE

    DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)-PESGP*YDCPG_SL2%SPSI (JROF)
      YDCPG_SL2%SPSI (JROF)=PESGP*YDCPG_SL2%SPSI (JROF)
    ENDDO

  ENDIF

ELSE

  IF (YDML_DYN%YRDYN%NVLAG==2.OR.YDML_DYN%YRDYN%NVLAG==3) THEN

    IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          ZMOYSPNL (JROF)=ZMOY1SP (JROF, JLEV)+YDCPG_SL2%SPSI (JROF)
          YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+PESGM&
          &*ZMOYSPNL (JROF)-PESGM*PBDT (JROF)*PSDIV9 (JROF)
          ZSPNLT_FE (JROF, JLEV)=PESGP*ZVWEI (JROF, JLEV)*ZMOYSPNL (JROF)
        ENDDO

      ENDDO

      ZSPNLT_FE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, 0)=0.0_JPRB
      ZSPNLT_FE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDGEOMETRY%YRDIMV%NFLEVG+1)=0.0_JPRB
      CALL VERDISINT (YDGEOMETRY%YRVERT_GEOM%YRVFE, YDGEOMETRY%YRVERT_GEOM%YRCVER,'ITOP','11', YDGEOMETRY%YRDIM&
      &%NPROMA, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, YDGEOMETRY%YRDIMV%NFLEVG, ZSPNLT_FE, POUTS=ZSPT1)

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+ZSPT1 (JROF)
      ENDDO

    ELSE

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
          ZMOYSPNL (JROF)=ZMOY1SP (JROF, JLEV)+YDCPG_SL2%SPSI (JROF)
          YDCPG_SL1%C9%P (JROF, JLEV)=YDCPG_SL1%C9%P (JROF, JLEV)+PESGM&
          &*ZMOYSPNL (JROF)-PESGM*PBDT (JROF)*PSDIV9 (JROF)
          YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)+PESGP*ZVWEI (JROF, JLEV)*ZMOYSPNL (JROF)
        ENDDO

      ENDDO

    ENDIF


    DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      YDCPG_SL1%SP9%P (JROF)=YDCPG_SL1%SP9%P (JROF)+YDVARS%SP&
      &%T9 (JROF)+PCMSLP*YDVARS%GEOMETRY%OROG%T0 (JROF)
      YDVARS%SP%T1 (JROF)=YDVARS%SP%T1 (JROF)-PCMSLP*YDVARS%GEOMETRY&
      &%OROG%T0 (JROF)-PESGP*YDCPG_SL2%SPSI (JROF)
      YDCPG_SL2%SPSI (JROF)=PESGP*YDCPG_SL2%SPSI (JROF)
    ENDDO

  ENDIF

ENDIF

IF (LHOOK) CALL DR_HOOK ('LATTES_OUTLINE_000', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
