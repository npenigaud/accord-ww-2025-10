SUBROUTINE LASSIE (YDCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDDYN, YDDYNA&
&, PRCORI, PSDIV0, PSDIV9, PTOD0, PTOD9, PGAGT0L, PGAGT0M, PGAGT9L, PGAGT9M)
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE PARKIND1,ONLY:JPIM, JPRB
USE YOMHOOK,ONLY:DR_HOOK, JPHOOK, LHOOK
USE YOMCST,ONLY:TCST
USE YOMDYN,ONLY:TDYN
USE YOMDYNA,ONLY:TDYNA
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (TDYN), INTENT (IN)::YDDYN
TYPE (TDYNA), INTENT (IN)::YDDYNA
REAL (KIND=JPRB), INTENT (IN)::PRCORI (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (OUT)::PSDIV0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (OUT)::PSDIV9 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (INOUT)::PTOD0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PTOD9 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PGAGT0L (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PGAGT0M (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PGAGT9L (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PGAGT9M (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZR9 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
#include "gprcp_expl.intfb.h"
#include "lassie_gprcp.intfb.h"
#include "lassie_sitnu.intfb.h"
#include "sigam_gp.intfb.h"
#include "sitnu_gp.intfb.h"
IF (LHOOK) CALL DR_HOOK ('LASSIE', 0, ZHOOK_HANDLE)


CALL LASSIE_SITNU (YDCPG_BNDS, YDCPG_OPTS, YDCST, YDDYN,&
& YDGEOMETRY, YDVARS, PGAGT0L, PGAGT0M, PSDIV0, PTOD0)

IF (.NOT.YDDYNA%LTWOTL) THEN
  
  CALL SITNU_GP (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY%YRDIMV%NFLEVG&
  &, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, YDVARS%DIV%T9, PTOD9, PSDIV9)
  CALL SIGAM_GP (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY%YRDIMV%NFLEVG&
  &, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, PGAGT9L, YDVARS%T%DL9, YDVARS%SP%DL9)
  CALL SIGAM_GP (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY%YRDIMV%NFLEVG&
  &, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, PGAGT9M, YDVARS%T%DM9, YDVARS%SP%DM9)
  
ENDIF


IF (YDDYNA%LSPRT) THEN

  IF (YDDYNA%LTWOTL) THEN
    CALL GPRCP_EXPL (YDCST, YDCPG_BNDS, YDCPG_OPTS, YDVARS=YDVARS, PR=ZR9)
    CALL LASSIE_GPRCP (YDCPG_BNDS, YDCST, YDGEOMETRY, PTOD0, ZR9)
  ELSE
    
    CALL GPRCP_EXPL (YDCST, YDCPG_BNDS, YDCPG_OPTS, YDVARS=YDVARS, PR=ZR9, KGFLTYP=9)

    DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        PTOD0 (JROF, JLEV)=YDCST%RD*PTOD0 (JROF, JLEV)/ZR9 (JROF, JLEV)
        PTOD9 (JROF, JLEV)=YDCST%RD*PTOD9 (JROF, JLEV)/ZR9 (JROF, JLEV)
      ENDDO

    ENDDO

    
  ENDIF

ENDIF


IF (YDDYN%LIMPF) THEN
  

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

    DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      PGAGT0L (JROF, JLEV)=PGAGT0L (JROF, JLEV)-PRCORI (JROF)*YDVARS%V%T0 (JROF, JLEV)
      PGAGT0M (JROF, JLEV)=PGAGT0M (JROF, JLEV)+PRCORI (JROF)*YDVARS%U%T0 (JROF, JLEV)
    ENDDO

  ENDDO


  IF (.NOT.YDDYNA%LTWOTL) THEN

    DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

      DO JROF=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        PGAGT9L (JROF, JLEV)=PGAGT9L (JROF, JLEV)-PRCORI (JROF)*YDVARS%V%T9 (JROF, JLEV)
        PGAGT9M (JROF, JLEV)=PGAGT9M (JROF, JLEV)+PRCORI (JROF)*YDVARS%U%T9 (JROF, JLEV)
      ENDDO

    ENDDO

  ENDIF

  
ENDIF



IF (LHOOK) CALL DR_HOOK ('LASSIE', 1, ZHOOK_HANDLE)
ENDSUBROUTINE LASSIE
