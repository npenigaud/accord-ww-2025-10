SUBROUTINE ACVPPKF_PART0 (LDOCHTRANS, K_KCH1, YDCPG_BNDS, YDCPG_OPTS, YDCST, YDML_PHY_MF&
&, KCLBAS, KCLBASS, KCLTOP, KCLTOPS, K_KCLBAS, K_KCLTOP, PAPHIF, PAPRSF, PDELP, PQ, PQI&
&, PQL, PT, PTKE, PU, PV, PDPSG, PDQIDT, PDQLDT, PDQVDT, PDTDT, PDUDT, PDVDT, PLS, PLV,&
& PPABS, PQC, PRC, PRCTEN, PRI, PRITEN, PRV, PRVTEN, PSHAL_ZCH1, PSHAL_ZCH1TEN, ZT, PTKECLS&
&, PTTEN, PUMF, PUMFMAX, PUQL, PUQV, PURCI, PURV, PUTEN, PVTEN, PZUMF, PZW, PZZ)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE MODEL_PHYSICS_MF_MOD,ONLY:MODEL_PHYSICS_MF_TYPE
USE YOMCST,ONLY:TCST
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

LOGICAL, INTENT (INOUT)::LDOCHTRANS
INTEGER (KIND=JPIM), INTENT (IN)::K_KCH1
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (TCST), INTENT (IN)::YDCST
TYPE (MODEL_PHYSICS_MF_TYPE), INTENT (IN)::YDML_PHY_MF
INTEGER (KIND=JPIM), INTENT (INOUT)::KCLBAS (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM), INTENT (INOUT)::KCLBASS (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM), INTENT (INOUT)::KCLTOP (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM), INTENT (INOUT)::KCLTOPS (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM), INTENT (INOUT)::K_KCLBAS (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM), INTENT (INOUT)::K_KCLTOP (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PAPRSF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PDELP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PTKE (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PU (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDPSG (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDQIDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDQLDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDQVDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDTDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDUDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDVDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PLS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PLV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PPABS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PQC (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRC (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRCTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRITEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PRVTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PSHAL_ZCH1 (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, K_KCH1)
REAL (KIND=JPRB), INTENT (INOUT)::PSHAL_ZCH1TEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, K_KCH1)
REAL (KIND=JPRB), INTENT (INOUT)::ZT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PTKECLS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PTTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PUMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PUMFMAX (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PUQL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PUQV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PURCI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PURV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PUTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PVTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PZUMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PZW (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PZZ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
#include "fcttrm.func.h"
#include "fcttrm.func.h"
INTEGER::JKP
INTEGER::JN
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::I_KCOUNT (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZAPHIF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZCAPE (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZCH1 (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, K_KCH1)
REAL (KIND=JPRB)::ZU (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZW (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('ACVPPKF_PART0', 0, ZHOOK_HANDLE)
PUMFMAX (:)=1.E-12_JPRB
ZW (:,:)=0.0_JPRB
PTKECLS (:)=0.0_JPRB

IF (YDML_PHY_MF%YRPHY%LECT) THEN

  DO JLEV=1, YDCPG_OPTS%KFLEVG

    DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
      ZW (JLON, JLEV)=SQRT (MIN (3.0_JPRB, MAX (YDML_PHY_MF%YRPHY0&
      &%ECTMIN, PTKE (JLON, JLEV)))/YDML_PHY_MF%YRPHY0%AECLS4)
    ENDDO

  ENDDO


  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PTKECLS (JLON)=PTKE (JLON, YDCPG_OPTS%KFLEVG)
  ENDDO

ENDIF


DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PDPSG (JLON, JLEV)=PDELP (JLON, JLEV)/YDCST%RG
    ZAPHIF (JLON, JLEV)=PAPHIF (JLON, JLEV)/YDCST%RG
  ENDDO

ENDDO


DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PDTDT (JLON, JLEV)=0.0_JPRB
    PDQVDT (JLON, JLEV)=0.0_JPRB
    PDQLDT (JLON, JLEV)=0.0_JPRB
    PDQIDT (JLON, JLEV)=0.0_JPRB
    PDUDT (JLON, JLEV)=0.0_JPRB
    PDVDT (JLON, JLEV)=0.0_JPRB
    PUMF (JLON, JLEV)=0.0_JPRB
    PUQV (JLON, JLEV)=0.0_JPRB
    PUQL (JLON, JLEV)=0.0_JPRB
    PLV (JLON, JLEV)=FOLH (PT (JLON, JLEV), 0.0_JPRB)
    PLS (JLON, JLEV)=FOLH (PT (JLON, JLEV), 1.0_JPRB)
    PQC (JLON, JLEV)=PQL (JLON, JLEV)+PQI (JLON, JLEV)
  ENDDO

ENDDO


DO JLON=1, YDCPG_BNDS%KFDIA
  I_KCOUNT (JLON)=0
  ZCAPE (JLON)=0.0_JPRB
ENDDO

K_KCLTOP (:)=1
K_KCLBAS (:)=1
KCLTOP (:)=1
KCLBAS (:)=1
KCLTOPS (:)=1
KCLBASS (:)=1

DO JLEV=1, YDCPG_OPTS%KFLEVG
  JKP=YDCPG_OPTS%KFLEVG-JLEV+1

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
    PPABS (JLON, JKP)=PAPRSF (JLON, JLEV)
    PZZ (JLON, JKP)=ZAPHIF (JLON, JLEV)
    ZT (JLON, JKP)=PT (JLON, JLEV)
    PRV (JLON, JKP)=PQ (JLON, JLEV)/(1.0-PQ (JLON, JLEV))
    PRC (JLON, JKP)=PQL (JLON, JLEV)/(1.0-PQL (JLON, JLEV))
    PRI (JLON, JKP)=PQI (JLON, JLEV)/(1.0-PQI (JLON, JLEV))
    ZU (JLON, JKP)=PU (JLON, JLEV)
    ZV (JLON, JKP)=PV (JLON, JLEV)
    PZW (JLON, JKP)=ZW (JLON, JLEV)
  ENDDO

ENDDO


IF (LDOCHTRANS) THEN

  DO JLEV=1, YDCPG_OPTS%KFLEVG
    JKP=YDCPG_OPTS%KFLEVG-JLEV+1

    DO JN=1, K_KCH1

      DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
        PSHAL_ZCH1 (JLON, JKP, JN)=ZCH1 (JLON, JLEV, JN)
      ENDDO

    ENDDO

  ENDDO

ENDIF

I_KCOUNT (:)=0
PTTEN (:,:)=0.0
PRVTEN (:,:)=0.0
PRCTEN (:,:)=0.0
PRITEN (:,:)=0.0
PUTEN (:,:)=0.0
PVTEN (:,:)=0.0
PZUMF (:,:)=0.0
PURV (:,:)=0.0
PURCI (:,:)=0.0
PSHAL_ZCH1TEN (:,:,:)=0.0
ZCAPE (:)=0.0
IF (LHOOK) CALL DR_HOOK ('ACVPPKF_PART0', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
