SUBROUTINE APL_ARPEGE_ACEVADCAPE (YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS, YDMF_PHYS_BASE_STATE&
&, YDMODEL, YDVARS, KMOC_CLPH, PBLH, PDCAPE, PTKE1)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE TYPE_MODEL,ONLY:MODEL
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (MODEL), INTENT (IN)::YDMODEL
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
INTEGER (KIND=JPIM), INTENT (INOUT)::KMOC_CLPH (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PBLH (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PDCAPE (YDCPG_OPTS%KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PTKE1 (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
#include "accldia.intfb.h"
#include "acevadcape.intfb.h"
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_ACEVADCAPE', 0, ZHOOK_HANDLE)
CALL ACEVADCAPE (YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRCST, YDCPG_BNDS%KIDIA, YDCPG_BNDS&
&%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDMF_PHYS%OUT%FPLSL, YDMF_PHYS%OUT%FPLSN, YDMF_PHYS&
&%OUT%FPLCL, YDMF_PHYS%OUT%FPLCN, YDMF_PHYS_BASE_STATE%YCPG_PHY%PREHYD, YDMF_PHYS_BASE_STATE&
&%YCPG_PHY%PREHYDF, YDMF_PHYS_BASE_STATE%T, YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%CP, YDMF_PHYS_BASE_STATE&
&%YCPG_DYN%PHIF, YDMF_PHYS_BASE_STATE%YCPG_DYN%PHI, PDCAPE)
CALL ACCLDIA (YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST, YDMODEL%YRML_PHY_MF&
&%YRPHY, YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA&
&, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDMF_PHYS%OUT%UCLS, YDMF_PHYS%OUT%VCLS, YDMF_PHYS_BASE_STATE&
&%U, YDMF_PHYS_BASE_STATE%V, YDMF_PHYS%OUT%CAPE, PDCAPE, PTKE1, YDMF_PHYS_BASE_STATE%YCPG_DYN%PHIF&
&, YDVARS%GEOMETRY%OROG%T0, YDMF_PHYS%OUT%UGST, YDMF_PHYS%OUT%VGST, PBLH, KMOC_CLPH)

DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  YDMF_PHYS%OUT%CLPH (JLON)=MIN (YDMODEL%YRML_PHY_MF%YRPHY0%XMAXLM&
  &, MAX (YDMODEL%YRML_PHY_MF%YRPHY0%XMINLM, PBLH (JLON)))
ENDDO

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_ACEVADCAPE', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
