SUBROUTINE LACDYN (YDCST, YDGEOMETRY, YDVARS, YDCPG_SL1, YDCPG_SL2, YDCPG_BNDS, YDCPG_OPTS&
&, YDCPG_TND, YDCPG_DYN0, YDCPG_DYN9, YDMODEL, YDCPG_SLMISC, YDCPG_TNDSI_DDH, YDA_PWRL9)
USE TYPE_MODEL,ONLY:MODEL
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_TYPE_MOD,ONLY:CPG_DYN_TYPE, CPG_TND_TYPE
USE CPG_SL1_TYPE_MOD,ONLY:CPG_SL1B_TYPE
USE CPG_SL2_TYPE_MOD,ONLY:CPG_SL2_TYPE
USE PARKIND1,ONLY:JPRB
USE YOMHOOK,ONLY:DR_HOOK, JPHOOK, LHOOK
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE YOMCST,ONLY:TCST
USE CPG_DDH_TND_TYPE_MOD,ONLY:CPG_TNDSI_DDH_TYPE
USE CPG_SLMISC_TYPE_MOD,ONLY:CPG_SLMISC_TYPE
USE FIELD_ARRAY_MODULE,ONLY:FIELD_3RB_ARRAY

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (CPG_SL1B_TYPE), INTENT (INOUT)::YDCPG_SL1
TYPE (CPG_SL2_TYPE), INTENT (INOUT)::YDCPG_SL2
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_TND_TYPE), INTENT (INOUT)::YDCPG_TND
TYPE (CPG_DYN_TYPE), INTENT (INOUT)::YDCPG_DYN0
TYPE (CPG_DYN_TYPE), INTENT (INOUT)::YDCPG_DYN9
TYPE (MODEL), INTENT (IN)::YDMODEL
TYPE (CPG_SLMISC_TYPE), INTENT (INOUT)::YDCPG_SLMISC
TYPE (CPG_TNDSI_DDH_TYPE), INTENT (INOUT)::YDCPG_TNDSI_DDH
TYPE (FIELD_3RB_ARRAY), INTENT (INOUT)::YDA_PWRL9
REAL (KIND=JPRB)::ZDTS2
REAL (KIND=JPRB)::ZBT
REAL (KIND=JPRB)::ZREDIV (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZBDT (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZGAGT0M (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZGAGT0L (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZGAGT9M (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZGAGT9L (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZLPD9 (YDGEOMETRY%YRDIM%NPROMNH, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZLPD0 (YDGEOMETRY%YRDIM%NPROMNH, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZSDIV9 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZSDIV0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB)::ZSPDS9 (YDGEOMETRY%YRDIM%NPROMNH, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZSPDS0 (YDGEOMETRY%YRDIM%NPROMNH, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZTOD9 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZTOD0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZMIXNL (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::ZALPHA (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
LOGICAL::LLGWADV
LOGICAL::LL2TLFF1
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
#include "lanhsi.intfb.h"
#include "lacdyn_zmixnl.intfb.h"
#include "lacdyn_lasure.intfb.h"
#include "lanhqesi.intfb.h"
#include "lanhsib.intfb.h"
#include "lassie.intfb.h"

#include "latte_bbc.intfb.h"
#include "latte_kappa.intfb.h"
#include "latte_nl.intfb.h"
#include "latte_stddis.intfb.h"
#include "lattes.intfb.h"
#include "lattex.intfb.h"
#include "lavabo.intfb.h"
#include "lavent.intfb.h"
IF (LHOOK) CALL DR_HOOK ('LACDYN', 0, ZHOOK_HANDLE)



ZDTS2=0.5_JPRB*YDCPG_OPTS%ZDT
ZBT=ZDTS2*YDCPG_OPTS%ZBETADT
LL2TLFF1=YDMODEL%YRML_DYN%YRDYN%L2TLFF.AND.(YDMODEL%YRML_PHY_MF%YRPHY%LMPHYS.OR.YDMODEL&
&%YRML_PHY_EC%YREPHY%LEPHYS).AND.(.NOT.YDMODEL%YRML_PHY_EC%YREPHY%LAGPHY)
CALL LACDYN_LASURE (YDCPG_BNDS, YDGEOMETRY, YDMODEL, YDVARS, ZBT, ZBDT, ZREDIV)

IF (YDMODEL%YRML_DYN%YRDYNA%LNHEE.OR.YDMODEL%YRML_DYN%YRDYNA%LNHHY) THEN
  
  CALL LANHSI (YDMODEL%YRCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDMODEL%YRML_DYN%YRDYN, YDMODEL&
  &%YRML_DYN%YRDYNA, YDMODEL%YRML_DYN%YRDYNA%LGWADV, YDVARS%GEOMETRY%RCORI%T0, ZREDIV, ZSDIV0, ZSDIV9&
  &, ZTOD0, ZTOD9, ZGAGT0L, ZGAGT0M, ZGAGT9L, ZGAGT9M, ZSPDS0, ZSPDS9, ZLPD0, ZLPD9)
  
ELSEIF (YDMODEL%YRML_DYN%YRDYNA%LNHQE) THEN
  
  CALL LANHQESI (YDMODEL%YRCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDMODEL%YRML_DYN%YRDYN&
  &, YDMODEL%YRML_DYN%YRDYNA, YDMODEL%YRML_DYN%YRDYNA%LGWADV, YDVARS%GEOMETRY%RCORI%T0, ZREDIV, ZSDIV0&
  &, ZSDIV9, ZTOD0, ZTOD9, ZGAGT0L, ZGAGT0M, ZGAGT9L, ZGAGT9M, ZSPDS0, ZSPDS9, ZLPD0, ZLPD9)
  
ELSE
  CALL LASSIE (YDMODEL%YRCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDMODEL&
  &%YRML_DYN%YRDYN, YDMODEL%YRML_DYN%YRDYNA, YDVARS%GEOMETRY%RCORI%T0, ZSDIV0&
  &, ZSDIV9, ZTOD0, ZTOD9, ZGAGT0L, ZGAGT0M, ZGAGT9L, ZGAGT9M)
ENDIF


IF ((YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==0).OR.(YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER>0.AND&
  &.YDMODEL%YRML_DYN%YRDYNA%LPC_FULL.AND.(.NOT.YDMODEL%YRML_DYN%YRDYNA%LPC_CHEAP))) THEN
  CALL LAVENT (YDCST, YDGEOMETRY, YDCPG_OPTS, YDCPG_BNDS, YDVARS, YDCPG_TND, YDCPG_SL1, YDCPG_SL2&
  &, YDMODEL%YRML_GCONF%YRRIP, YDMODEL%YRML_DYN, YDMODEL%YRML_PHY_MF%YRPARAR, YDCPG_SLMISC%ISETTLOFF&
  &, LL2TLFF1, ZDTS2, YDCPG_DYN0%XYB%RDELP, YDCPG_DYN0%CTY%EVEL, YDA_PWRL9%P, ZALPHA)
ENDIF


IF (YDMODEL%YRML_DYN%YRDYNA%LMIXETTLS) THEN
  
  CALL LATTE_NL (YDCPG_OPTS%NSTEP, YDCPG_OPTS%LRPLANE, YDCST, YDGEOMETRY, YDMODEL%YRML_DYN, YDMODEL&
  &%YRML_GCONF%YRRIP, YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA, ZDTS2, ZBDT, YDVARS%U%T0, YDVARS%V&
  &%T0, YDCPG_DYN0%CTY%EVEL, YDCPG_DYN0%XYB%RDELP, ZMIXNL, YDCPG_SLMISC%ISETTLOFF)
  
ELSE
  CALL LACDYN_ZMIXNL (YDGEOMETRY, ZMIXNL)
ENDIF

CALL LATTEX (YDMODEL%YRCST, YDGEOMETRY, YDVARS, YDCPG_TND, YDCPG_SL1, YDCPG_SL2, YDCPG_BNDS, YDCPG_OPTS&
&, YDMODEL%YRML_DIAG%YRLDDH, YDMODEL%YRML_DIAG%YRMDDH, YDMODEL%YRML_GCONF, YDMODEL%YRML_DYN, ZDTS2&
&, ZBT, ZBDT, YDMODEL%YRML_DYN%YRDYN%RESGP, YDMODEL%YRML_DYN%YRDYN%RESGM, YDCPG_DYN0%OROGL, YDCPG_DYN0&
&%OROGM, YDCPG_DYN0%PHIF, ZGAGT0L, ZGAGT0M, ZTOD0, ZSPDS0, ZLPD0, ZGAGT9L, ZGAGT9M, ZTOD9, ZSPDS9&
&, ZLPD9, YDCPG_DYN0%XYB%RDELP, YDCPG_DYN0%CTY%EVEL, YDCPG_DYN0%NHX, YDCPG_DYN0%GWT, YDCPG_DYN0&
&%GWFT, YDCPG_DYN9%NHX, YDCPG_DYN9%GWT, ZMIXNL, YDCPG_TNDSI_DDH)

IF (YDMODEL%YRML_DYN%YRDYNA%LNHDYN.AND.YDMODEL%YRML_DYN%YRDYNA&
  &%LRDBBC.AND.(.NOT.YDMODEL%YRML_DYN%YRDYNA%LGWADV)) THEN
  
  CALL LATTE_BBC (YDGEOMETRY, YDVARS, YDCPG_SL1, YDCPG_SL2, YDCPG_BNDS, YDCPG_OPTS&
  &, YDMODEL%YRML_DYN, ZDTS2, YDMODEL%YRML_DYN%YRDYN%RESGP, YDMODEL%YRML_DYN%YRDYN&
  &%RESGM, YDCPG_DYN0%DBBC, YDCPG_DYN0%RDPHI, ZMIXNL, YDCPG_DYN0%GWS)
  
ENDIF

CALL LATTES (YDCST, YDGEOMETRY, YDCPG_BNDS, YDCPG_OPTS, YDVARS, YDCPG_SL1, YDCPG_SL2&
&, YDMODEL%YRML_GCONF%YRRIP, YDMODEL%YRML_DYN, ZDTS2, ZBDT, YDMODEL%YRML_DYN%YRDYN&
&%RESGP, YDMODEL%YRML_DYN%YRDYN%RESGM, YDCPG_DYN0%OROGL, YDCPG_DYN0%OROGM, ZSDIV0&
&, ZSDIV9, YDCPG_DYN0%CTY%PSDVBC, YDCPG_DYN0%PRE, ZMIXNL)

IF (YDMODEL%YRML_DYN%YRDYNA%LSLHD) THEN
  
  CALL LATTE_KAPPA (YDCST, YDGEOMETRY, YDVARS, YDCPG_SL1, YDCPG_SL2, YDCPG_BNDS&
  &, YDCPG_OPTS, YDMODEL%YRML_DYN%YRDYN, YDMODEL%YRML_DYN%YRDYNA, ZDTS2, YDCPG_SLMISC&
  &%SLHDA, YDCPG_SLMISC%SLHDD0, YDCPG_DYN0%UVH%UH, YDCPG_DYN0%UVH%VH, YDCPG_DYN0&
  &%PRE (1:, YDGEOMETRY%YRDIMV%NFLEVG), ZALPHA, YDCPG_DYN0%XYB%RDELP)
  
ENDIF


IF (YDMODEL%YRML_DYN%YRDYNA%LCOMAD) THEN
  
  CALL LATTE_STDDIS (YDGEOMETRY, YDMODEL%YRML_DYN%YRDYNA&
  &, YDVARS, YDCPG_SL2, YDCPG_BNDS, YDCPG_OPTS, ZDTS2)
  
ENDIF


IF ((YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==0).OR.(YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER>0.AND&
  &.YDMODEL%YRML_DYN%YRDYNA%LPC_FULL.AND.(.NOT.YDMODEL%YRML_DYN%YRDYNA%LPC_CHEAP))) THEN
  CALL LAVABO (YDGEOMETRY, YDMODEL, YDCPG_BNDS, YDCPG_OPTS, YDCPG_SL1, LL2TLFF1)
ENDIF


IF (YDMODEL%YRML_DYN%YRDYNA%LGWADV) THEN
  
  LLGWADV=.FALSE.

  IF (YDMODEL%YRML_DYN%YRDYNA%LNHEE.OR.YDMODEL%YRML_DYN%YRDYNA%LNHHY) THEN
    CALL LANHSI (YDMODEL%YRCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDMODEL%YRML_DYN&
    &%YRDYN, YDMODEL%YRML_DYN%YRDYNA, LLGWADV, YDVARS%GEOMETRY%RCORI%T0, ZREDIV, ZSDIV0, ZSDIV9&
    &, ZTOD0, ZTOD9, ZGAGT0L, ZGAGT0M, ZGAGT9L, ZGAGT9M, ZSPDS0, ZSPDS9, ZLPD0, ZLPD9)
  ELSEIF (YDMODEL%YRML_DYN%YRDYNA%LNHQE) THEN
    CALL LANHQESI (YDMODEL%YRCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDMODEL%YRML_DYN&
    &%YRDYN, YDMODEL%YRML_DYN%YRDYNA, LLGWADV, YDVARS%GEOMETRY%RCORI%T0, ZREDIV, ZSDIV0, ZSDIV9&
    &, ZTOD0, ZTOD9, ZGAGT0L, ZGAGT0M, ZGAGT9L, ZGAGT9M, ZSPDS0, ZSPDS9, ZLPD0, ZLPD9)
  ENDIF

  CALL LANHSIB (YDGEOMETRY, YDVARS, YDCPG_SL1, YDCPG_SL2, YDCPG_BNDS, YDCPG_OPTS&
  &, YDMODEL%YRML_DYN, ZBT, ZBDT, YDMODEL%YRML_DYN%YRDYN%RESGP, ZGAGT0L, ZGAGT0M&
  &, ZTOD0, ZSPDS0, ZLPD0, ZSDIV0, YDCPG_DYN0%NHX, ZMIXNL)
  
ENDIF




IF (LHOOK) CALL DR_HOOK ('LACDYN', 1, ZHOOK_HANDLE)
ENDSUBROUTINE LACDYN
