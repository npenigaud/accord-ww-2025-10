MODULE YOMTRC

!$ACDC methods 


USE PARKIND1  ,ONLY : JPRB

IMPLICIT NONE

SAVE

! ------------------------------------------------------------------------------
! GLOBAL STORAGE FOR SOLAR/THERMAL OPTICAL DEPTHS (INTERMITTENCY CASE):

! GRSURF  : CORRECTIVE RATIO FOR SURFACE CTS CONTRIBUTION
! GDEOTI  : DESCENDING INCREMENTAL OPTICAL DEPTHS, dB/dT(T0) WEIGHTS
! GDEOTI2 : DESCENDING INCREMENTAL OPTICAL DEPTHS, B WEIGHTS WITH
!           LINEAR T_e CORRECTION
! GUEOTI  : ASCENDING INCREMENTAL OPTICAL DEPTHS, dB/dT(T0) WEIGHTS
! GUEOTI2 : ASCENDING INCREMENTAL OPTICAL DEPTHS, B WEIGHTS WITH
!           LINEAR T_e CORRECTION
! GEOLT   : LOCAL OPTICAL DEPTHS, dB/dT(T0) WEIGHTS
! GEOXT   : MAXIMUM OPTICAL DEPTHS FOR EBL-EAL, dB/dT(T0) WEIGHTS
! GRPROX  : CORRECTION TERM FOR ADJACENT EXCHANGES
! GMIXP   : NON-STATISTICAL WEIGHTS FOR BRACKETING
! GFLUXC  : OUT OF BRACKET PART OF CLEARSKY EBL, RESP. EBL-EAL FLUX
! GDEOSI  : DESCENDING INCREMENTAL OPTICAL DEPTHS, SOLAR
! GUEOSI  : ASCENDING  INCREMENTAL OPTICAL DEPTHS, SOLAR
! GMU0    : COSINE OF SOLAR ZENITH ANGLE, APPROXIMATE ACTUAL VALUE
! GMU0_MIN: COSINE OF SOLAR ZENITH ANGLE, MIN VALUE
! GMU0_MAX: COSINE OF SOLAR ZENITH ANGLE, MAX VALUE
! ------------------------------------------------------------------------------

TYPE :: TTRC
REAL(KIND=JPRB),ALLOCATABLE:: GRSURF  (:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GDEOTI  (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GDEOTI2 (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GUEOTI  (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GUEOTI2 (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GEOLT   (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GEOXT   (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GRPROX  (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GMIXP   (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GFLUXC  (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GDEOSI  (:,:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GUEOSI  (:,:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GMU0    (:,:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GMU0_MIN(:,:)
REAL(KIND=JPRB),ALLOCATABLE:: GMU0_MAX(:,:)
!----------------------------------------------------------------------------
CONTAINS
  PROCEDURE, PASS :: PRINT => PRINT_CONFIGURATION 
PROCEDURE :: ACDC_COPY => ACDC_COPY_TTRC
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_TTRC
PROCEDURE :: ACDC_HOST => ACDC_HOST_TTRC
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_TTRC
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_TTRC
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_TTRC
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_TTRC
END TYPE TTRC
!============================================================================

!!TYPE(TTRC), POINTER :: YRTRC => NULL()

!   ----------------------------------------------------------------

INTERFACE

MODULE SUBROUTINE ACDC_COPY_TTRC (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TTRC), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_TTRC (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (TTRC), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_TTRC (SELF)

IMPLICIT NONE
CLASS (TTRC), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_TTRC (SELF, KLUN)
USE PARKIND1, ONLY : JPRD
IMPLICIT NONE
CLASS (TTRC), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_TTRC (SELF, KLUN)

IMPLICIT NONE
CLASS (TTRC), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_TTRC (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
CLASS (TTRC),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_TTRC (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TTRC), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS

SUBROUTINE PRINT_CONFIGURATION(SELF, KDEPTH, KOUTNO)
IMPLICIT NONE
CLASS(TTRC), INTENT(IN) :: SELF
INTEGER    , INTENT(IN) :: KDEPTH
INTEGER    , INTENT(IN) :: KOUTNO

INTEGER :: IDEPTHLOC

IDEPTHLOC = KDEPTH+2

WRITE(KOUTNO,*) REPEAT(' ',KDEPTH   ) // 'model%yrml_phy_rad%yrtrc : '
IF (ALLOCATED(SELF%GRSURF)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GRSURF ALLOCATED OF SHAPE ', SHAPE(SELF%GRSURF), &
 &        ' SUM = ', SUM(SELF%GRSURF)
IF (ALLOCATED(SELF%GDEOTI)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GDEOTI ALLOCATED OF SHAPE ', SHAPE(SELF%GDEOTI), &
 &        ' SUM = ', SUM(SELF%GDEOTI)
IF (ALLOCATED(SELF%GDEOTI2)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GDEOTI2 ALLOCATED OF SHAPE ', SHAPE(SELF%GDEOTI2), &
 &        ' SUM = ', SUM(SELF%GDEOTI2)
IF (ALLOCATED(SELF%GUEOTI)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GUEOTI ALLOCATED OF SHAPE ', SHAPE(SELF%GUEOTI), &
 &        ' SUM = ', SUM(SELF%GUEOTI)
IF (ALLOCATED(SELF%GUEOTI2)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GUEOTI2 ALLOCATED OF SHAPE ', SHAPE(SELF%GUEOTI2), &
 &        ' SUM = ', SUM(SELF%GUEOTI2)
IF (ALLOCATED(SELF%GEOLT)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GEOLT ALLOCATED OF SHAPE ', SHAPE(SELF%GEOLT), &
 &        ' SUM = ', SUM(SELF%GEOLT)
IF (ALLOCATED(SELF%GEOXT)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GEOXT ALLOCATED OF SHAPE ', SHAPE(SELF%GEOXT), &
 &        ' SUM = ', SUM(SELF%GEOXT)
IF (ALLOCATED(SELF%GRPROX)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GRPROX ALLOCATED OF SHAPE ', SHAPE(SELF%GRPROX), &
 &        ' SUM = ', SUM(SELF%GRPROX)
IF (ALLOCATED(SELF%GMIXP)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GMIXP ALLOCATED OF SHAPE ', SHAPE(SELF%GMIXP), &
 &        ' SUM = ', SUM(SELF%GMIXP)
IF (ALLOCATED(SELF%GFLUXC)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GFLUXC ALLOCATED OF SHAPE ', SHAPE(SELF%GFLUXC), &
 &        ' SUM = ', SUM(SELF%GFLUXC)
IF (ALLOCATED(SELF%GDEOSI)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GDEOSI ALLOCATED OF SHAPE ', SHAPE(SELF%GDEOSI), &
 &        ' SUM = ', SUM(SELF%GDEOSI)
IF (ALLOCATED(SELF%GUEOSI)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GUEOSI ALLOCATED OF SHAPE ', SHAPE(SELF%GUEOSI), &
 &        ' SUM = ', SUM(SELF%GUEOSI)
IF (ALLOCATED(SELF%GMU0)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GMU0 ALLOCATED OF SHAPE ', SHAPE(SELF%GMU0), &
 &        ' SUM = ', SUM(SELF%GMU0)
IF (ALLOCATED(SELF%GMU0_MIN)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GMU0_MIN ALLOCATED OF SHAPE ', SHAPE(SELF%GMU0_MIN), &
 &        ' SUM = ', SUM(SELF%GMU0_MIN)
IF (ALLOCATED(SELF%GMU0_MAX)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GMU0_MAX ALLOCATED OF SHAPE ', SHAPE(SELF%GMU0_MAX), &
 &        ' SUM = ', SUM(SELF%GMU0_MAX)

END SUBROUTINE PRINT_CONFIGURATION

END MODULE YOMTRC
