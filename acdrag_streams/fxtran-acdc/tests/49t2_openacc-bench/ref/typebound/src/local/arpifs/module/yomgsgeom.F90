MODULE YOMGSGEOM

!$ACDC methods 


USE PARKIND1, ONLY : JPIM, JPRB

IMPLICIT NONE

SAVE

!     ------------------------------------------------------------------

!*    Grid point horizontal geometry: structure TGSGEOM

! RCORI      : Coriolis parameter "f = 2 Omega sin(theta)".
! RCORIC     : 2 Omega cos(theta).
! GEMU       : sine of geographic latitude "sin(theta)".
! GSQM2      : cosine of geographic latitude "cos(theta)".
! GELAM      : geographic longitude "lambda".
! GELAT      : geographic latitude "theta".
! GECLO      : cosine of geographic longitude "cos(lambda)".
! GESLO      : sine of geographic longitude "sin(lambda)".
! GELAMDEG   : geographic longitude "lambda" (in degrees)
! GELAMINF   : geographic inf grid-corner longitude "lambda".
! GELAMSUP   : geographic sup grid-corner longitude "lambda".
! GEXCO      : cartesian x-coordinate
! GEYCO      : cartesian y-coordinate
! GEZCO      : cartesian z-coordinate
! GM         : mapping factor "M".
! GMAPPA     : approximation of M**2 or RSTRET**2 according to model geometry.
! GOMVRL     : zonal component of vector "2 vec(Omega) wedge a vec(k)".
! GOMVRM     : meridian component of vector "2 vec(Omega) wedge a vec(k)".
! GNORDL     : zonal component "gnordl" of unit vector directed towards the geographic Northern pole.
! GNORDM     : meridian component "gnordm" of unit vector directed towards the geographic Northern pole.
! GNORDLCL   : zonal component of vector "grad(gnordl)".
! GNORDMCL   : zonal component of vector "grad(gnordm)".
! GNORDMCM   : meridian component of vector "grad(gnordm)".
! GAW        : Gaussian weight.
! NGPLAT     : DM-global number of the Gaussian grid latitude.
! NUNIQUEGP  : pointer array (see computation in sugem2.F90).

TYPE TGSGEOM
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: RCORI(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: RCORIC(:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEMU(:)      => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GSQM2(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAM(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAT(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GECLO(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GESLO(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAMDEG(:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAMINF(:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAMSUP(:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEXCO(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEYCO(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEZCO(:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GM(:)        => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GMAPPA(:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GOMVRL(:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GOMVRM(:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDL(:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDM(:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDLCL(:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDMCL(:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDMCM(:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GAW(:)       => NULL()
  INTEGER(KIND=JPIM), POINTER,CONTIGUOUS :: NGPLAT(:)    => NULL()
  INTEGER(KIND=JPIM), POINTER,CONTIGUOUS :: NUNIQUEGP(:) => NULL()
CONTAINS
PROCEDURE :: ACDC_COPY => ACDC_COPY_TGSGEOM
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_TGSGEOM
PROCEDURE :: ACDC_HOST => ACDC_HOST_TGSGEOM
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_TGSGEOM
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_TGSGEOM
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_TGSGEOM
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_TGSGEOM
END TYPE TGSGEOM

TYPE TGSGEOM_BLOCKED
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: RCORI(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: RCORIC(:,:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEMU(:,:)      => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GSQM2(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAM(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAT(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GECLO(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GESLO(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAMDEG(:,:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAMINF(:,:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GELAMSUP(:,:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEXCO(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEYCO(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GEZCO(:,:)     => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GM(:,:)        => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GMAPPA(:,:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GOMVRL(:,:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GOMVRM(:,:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDL(:,:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDM(:,:)    => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDLCL(:,:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDMCL(:,:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GNORDMCM(:,:)  => NULL()
  REAL(KIND=JPRB),    POINTER,CONTIGUOUS :: GAW(:,:)       => NULL()
  INTEGER(KIND=JPIM), POINTER,CONTIGUOUS :: NGPLAT(:,:)    => NULL()
  INTEGER(KIND=JPIM), POINTER,CONTIGUOUS :: NUNIQUEGP(:,:) => NULL()
CONTAINS
PROCEDURE :: ACDC_COPY => ACDC_COPY_TGSGEOM_BLOCKED
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_TGSGEOM_BLOCKED
PROCEDURE :: ACDC_HOST => ACDC_HOST_TGSGEOM_BLOCKED
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_TGSGEOM_BLOCKED
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_TGSGEOM_BLOCKED
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_TGSGEOM_BLOCKED
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_TGSGEOM_BLOCKED
END TYPE TGSGEOM_BLOCKED
  
! define blocked and non-blocked (_NB) structures
! note that the blocked structure YRGSGEOM will be initialised to point into 
! the non-blocked structure YRGSGEOM_NB
!!TYPE(TGSGEOM), POINTER :: YRGSGEOM(:)  => NULL()
!!TYPE(TGSGEOM), POINTER :: YRGSGEOM_NB  => NULL()

! ------------------------------------------------------------------
INTERFACE

MODULE SUBROUTINE ACDC_COPY_TGSGEOM (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TGSGEOM), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_TGSGEOM (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (TGSGEOM), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_TGSGEOM (SELF)

IMPLICIT NONE
CLASS (TGSGEOM), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_TGSGEOM (SELF, KLUN)
USE PARKIND1, ONLY : JPRD
IMPLICIT NONE
CLASS (TGSGEOM), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_TGSGEOM (SELF, KLUN)

IMPLICIT NONE
CLASS (TGSGEOM), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_TGSGEOM (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
CLASS (TGSGEOM),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_TGSGEOM (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TGSGEOM), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_TGSGEOM_BLOCKED (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_TGSGEOM_BLOCKED (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_TGSGEOM_BLOCKED (SELF)

IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_TGSGEOM_BLOCKED (SELF, KLUN)
USE PARKIND1, ONLY : JPRD
IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_TGSGEOM_BLOCKED (SELF, KLUN)

IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_TGSGEOM_BLOCKED (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_TGSGEOM_BLOCKED (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TGSGEOM_BLOCKED), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS
! ------------------------------------------------------------------

SUBROUTINE DEALLO_TGSGEOM(YDGSGEOM)

USE YOMHOOK, ONLY : LHOOK, DR_HOOK, JPHOOK

TYPE(TGSGEOM), POINTER, INTENT(INOUT) :: YDGSGEOM(:)
INTEGER(KIND=JPIM) :: J
REAL(KIND=JPHOOK)    :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('YOMGSGEOM:DEALLO_TGSGEOM',0,ZHOOK_HANDLE)

IF (ASSOCIATED(YDGSGEOM)) THEN
  DO J = 1, SIZE(YDGSGEOM)
    NULLIFY(YDGSGEOM(J)%RCORI    )
    NULLIFY(YDGSGEOM(J)%RCORIC   )
    NULLIFY(YDGSGEOM(J)%GEMU     )
    NULLIFY(YDGSGEOM(J)%GSQM2    )
    NULLIFY(YDGSGEOM(J)%GELAM    )
    NULLIFY(YDGSGEOM(J)%GELAT    )
    NULLIFY(YDGSGEOM(J)%GECLO    )
    NULLIFY(YDGSGEOM(J)%GESLO    )
    NULLIFY(YDGSGEOM(J)%GELAMDEG )
    NULLIFY(YDGSGEOM(J)%GELAMINF )
    NULLIFY(YDGSGEOM(J)%GELAMSUP )
    NULLIFY(YDGSGEOM(J)%GEXCO    )
    NULLIFY(YDGSGEOM(J)%GEYCO    )
    NULLIFY(YDGSGEOM(J)%GEZCO    )
    NULLIFY(YDGSGEOM(J)%GM       )
    NULLIFY(YDGSGEOM(J)%GMAPPA   )
    NULLIFY(YDGSGEOM(J)%GOMVRL   )
    NULLIFY(YDGSGEOM(J)%GOMVRM   )
    NULLIFY(YDGSGEOM(J)%GNORDL   )
    NULLIFY(YDGSGEOM(J)%GNORDM   )
    NULLIFY(YDGSGEOM(J)%GNORDLCL )
    NULLIFY(YDGSGEOM(J)%GNORDMCL )
    NULLIFY(YDGSGEOM(J)%GNORDMCM )
    NULLIFY(YDGSGEOM(J)%GAW      )
    NULLIFY(YDGSGEOM(J)%NGPLAT   )
    NULLIFY(YDGSGEOM(J)%NUNIQUEGP)
  ENDDO
  DEALLOCATE(YDGSGEOM)
ENDIF

IF (LHOOK) CALL DR_HOOK('YOMGSGEOM:DEALLO_TGSGEOM',1,ZHOOK_HANDLE)

END SUBROUTINE DEALLO_TGSGEOM

! ------------------------------------------------------------------

SUBROUTINE DEALLO_TGSGEOM_NB(YDGSGEOM)

USE YOMHOOK, ONLY : LHOOK, DR_HOOK, JPHOOK
USE DEALLOCATE_IF_ASSOCIATED_MOD, ONLY : DEALLOCATE_IF_ASSOCIATED

TYPE(TGSGEOM), INTENT(INOUT) :: YDGSGEOM
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('YOMGSGEOM:DEALLO_TGSGEOM_NB',0,ZHOOK_HANDLE)

CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%RCORI    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%RCORIC   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEMU     )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GSQM2    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAM    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAT    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GECLO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GESLO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAMDEG )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAMINF )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAMSUP )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEXCO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEYCO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEZCO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GM       )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GMAPPA   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GOMVRL   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GOMVRM   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDL   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDM   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDLCL )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDMCL )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDMCM )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GAW      )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%NGPLAT   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%NUNIQUEGP)

IF (LHOOK) CALL DR_HOOK('YOMGSGEOM:DEALLO_TGSGEOM_NB',1,ZHOOK_HANDLE)

END SUBROUTINE DEALLO_TGSGEOM_NB

SUBROUTINE DEALLO_TGSGEOM_B(YDGSGEOM)

USE YOMHOOK, ONLY : LHOOK, DR_HOOK, JPHOOK
USE DEALLOCATE_IF_ASSOCIATED_MOD, ONLY : DEALLOCATE_IF_ASSOCIATED

TYPE(TGSGEOM_BLOCKED), INTENT(INOUT) :: YDGSGEOM
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('YOMGSGEOM:DEALLO_TGSGEOM_B',0,ZHOOK_HANDLE)

CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%RCORI    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%RCORIC   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEMU     )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GSQM2    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAM    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAT    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GECLO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GESLO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAMDEG )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAMINF )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GELAMSUP )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEXCO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEYCO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GEZCO    )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GM       )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GMAPPA   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GOMVRL   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GOMVRM   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDL   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDM   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDLCL )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDMCL )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GNORDMCM )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%GAW      )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%NGPLAT   )
CALL DEALLOCATE_IF_ASSOCIATED(YDGSGEOM%NUNIQUEGP)

IF (LHOOK) CALL DR_HOOK('YOMGSGEOM:DEALLO_TGSGEOM_B',1,ZHOOK_HANDLE)

END SUBROUTINE DEALLO_TGSGEOM_B

! ------------------------------------------------------------------

END MODULE YOMGSGEOM
