MODULE YOMDIMF

!$ACDC methods 


USE PARKIND1 , ONLY : JPIM

IMPLICIT NONE

SAVE

TYPE :: TDIMF

! === NUMBER OF FIELDS ========================================================

! NFTHER : number of spectral thermodynamic variables
! NF3D   = number of 3D fields in the state of the model
! NFD2D  : number of 2D fields in the dynamics
! NFC2D  : number of 2D fields in the boundaries
! NPPM   : Number of interpolation methods in post-processing
! NS3D   : number of 3D fields in spectral space
! NS2D   : number of 2D fields in spectral space
! NS1D   : number of 1D fields in spectral space (for Aladin consistency -CF)
! NGRBSP2, NGRBSP3 - Grib codes for fields in SPA2 and SPA3

INTEGER(KIND=JPIM) :: NFTHER
INTEGER(KIND=JPIM) :: NF3D
INTEGER(KIND=JPIM) :: NFD2D
INTEGER(KIND=JPIM) :: NFC2D
!!INTEGER(KIND=JPIM) :: NPPM  !! moved to PARDIM in CY45
INTEGER(KIND=JPIM) :: NS3D
INTEGER(KIND=JPIM) :: NS2D
INTEGER(KIND=JPIM) :: NS1D
INTEGER(KIND=JPIM),ALLOCATABLE :: NGRBSP3(:)
INTEGER(KIND=JPIM),ALLOCATABLE :: NGRBSP2(:)


! === GRID POINT ARRAYS =======================================================

! LVOR  : controls the allocation of vorticity
! LADER : controls the allocation of vor div and derivatives
! LUVDER: controls the allocation of derivatives for u and v
! LSPT  : .TRUE. if temperature variable as spectral field

LOGICAL :: LVOR
LOGICAL :: LADER
LOGICAL :: LUVDER
LOGICAL :: LSPT
 
CONTAINS
  
  PROCEDURE, PASS :: PRINT => PRINT_CONFIGURATION 

PROCEDURE :: ACDC_COPY => ACDC_COPY_TDIMF
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_TDIMF
PROCEDURE :: ACDC_HOST => ACDC_HOST_TDIMF
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_TDIMF
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_TDIMF
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_TDIMF
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_TDIMF
END TYPE TDIMF

INTERFACE

MODULE SUBROUTINE ACDC_COPY_TDIMF (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TDIMF), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_TDIMF (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (TDIMF), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_TDIMF (SELF)

IMPLICIT NONE
CLASS (TDIMF), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_TDIMF (SELF, KLUN)

IMPLICIT NONE
CLASS (TDIMF), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_TDIMF (SELF, KLUN)

IMPLICIT NONE
CLASS (TDIMF), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_TDIMF (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
CLASS (TDIMF),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_TDIMF (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TDIMF), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS 
  
SUBROUTINE PRINT_CONFIGURATION(SELF, KDEPTH, KOUTNO)
  IMPLICIT NONE
  CLASS(TDIMF), INTENT(IN) :: SELF
  INTEGER     , INTENT(IN) :: KDEPTH
  INTEGER     , INTENT(IN) :: KOUTNO

  INTEGER :: IDEPTHLOC

  IDEPTHLOC = KDEPTH + 2
  
  WRITE(KOUTNO,*) REPEAT(' ',KDEPTH   ) // 'model%yrml_gconf%yrdimf : '
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NFTHER = ', SELF%NFTHER
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NF3D = ', SELF%NF3D
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NFD2D = ', SELF%NFD2D
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NFC2D = ', SELF%NFC2D
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NS3D = ', SELF%NS3D
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NS2D = ', SELF%NS2D
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NS1D = ', SELF%NS1D
  IF (ALLOCATED(SELF%NGRBSP3)) THEN
    WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NGRBSP3 allocated, size: ', SIZE(SELF%NGRBSP3)
  ELSE
    WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NGRBSP3 not allocated'
  END IF
  IF (ALLOCATED(SELF%NGRBSP2)) THEN
    WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NGRBSP2 allocated, size: ', SIZE(SELF%NGRBSP2)
  ELSE
    WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NGRBSP2 not allocated'
  END IF
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'LVOR = ', SELF%LVOR
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'LADER = ', SELF%LADER
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'LUVDER = ', SELF%LUVDER
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'LSPT = ', SELF%LSPT
  WRITE(KOUTNO,*) ''

END SUBROUTINE PRINT_CONFIGURATION


!!TYPE(TDIMF), POINTER :: YRDIMF => NULL()

!     ------------------------------------------------------------------
END MODULE YOMDIMF
