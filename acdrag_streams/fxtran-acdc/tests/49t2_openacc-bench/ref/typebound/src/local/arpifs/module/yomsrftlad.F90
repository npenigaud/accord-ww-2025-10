MODULE YOMSRFTLAD

!$ACDC methods 


USE PARKIND1  ,ONLY : JPRB,JPIM

IMPLICIT NONE

SAVE

! ------ SKIN TEMPERATURE FOR LINEARIZED PHYSICS

! GPSURF  : BUFFER FOR PERTURBATION OF TOP LAYER SURF. FIELDS 
!           (SKIN TEMPERATURE,...)
! NGSKIN  : NUMBER OF TOP SOIL FIELDS FOR PERTURBATION

! LREGSF  : .TRUE. if the regularization for SURF computation is used

TYPE :: TSRFTLAD
REAL(KIND=JPRB),ALLOCATABLE :: GPTSKIN0(:,:,:)
REAL(KIND=JPRB),ALLOCATABLE :: GPTSKIN9(:,:,:)

INTEGER(KIND=JPIM) :: NGSKIN

LOGICAL :: LREGSF
!----------------------------------------------------------------------------
CONTAINS
  PROCEDURE, PASS :: PRINT => PRINT_CONFIGURATION 
PROCEDURE :: ACDC_COPY => ACDC_COPY_TSRFTLAD
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_TSRFTLAD
PROCEDURE :: ACDC_HOST => ACDC_HOST_TSRFTLAD
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_TSRFTLAD
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_TSRFTLAD
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_TSRFTLAD
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_TSRFTLAD
END TYPE TSRFTLAD
!============================================================================

!!TYPE(TSRFTLAD), POINTER :: YRSRFTLAD => NULL()

!     ------------------------------------------------------------------

INTERFACE

MODULE SUBROUTINE ACDC_COPY_TSRFTLAD (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TSRFTLAD), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_TSRFTLAD (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (TSRFTLAD), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_TSRFTLAD (SELF)

IMPLICIT NONE
CLASS (TSRFTLAD), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_TSRFTLAD (SELF, KLUN)
USE PARKIND1, ONLY : JPRD
IMPLICIT NONE
CLASS (TSRFTLAD), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_TSRFTLAD (SELF, KLUN)

IMPLICIT NONE
CLASS (TSRFTLAD), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_TSRFTLAD (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
CLASS (TSRFTLAD),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_TSRFTLAD (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
CLASS (TSRFTLAD), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS

SUBROUTINE PRINT_CONFIGURATION(SELF, KDEPTH, KOUTNO)
  IMPLICIT NONE
  CLASS(TSRFTLAD), INTENT(IN) :: SELF
  INTEGER        , INTENT(IN) :: KDEPTH
  INTEGER        , INTENT(IN) :: KOUTNO

  INTEGER :: IDEPTHLOC

  IDEPTHLOC = KDEPTH+2
  
  WRITE(KOUTNO,*) REPEAT(' ',KDEPTH   ) // 'model%yrml_phy_slin%yrephli : '
  IF (ALLOCATED(SELF%GPTSKIN0)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GPTSKIN0 allocated of shape ', &
 &        SHAPE(SELF%GPTSKIN0),' and sum ',SUM(SELF%GPTSKIN0)
  IF (ALLOCATED(SELF%GPTSKIN9)) WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'GPTSKIN9 allocated of shape ', &
 &        SHAPE(SELF%GPTSKIN9),' and sum ',SUM(SELF%GPTSKIN9)
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'NGSKIN = ', SELF%NGSKIN
  WRITE(KOUTNO,*) REPEAT(' ',IDEPTHLOC) // 'LREGSF = ', SELF%LREGSF
 
END SUBROUTINE PRINT_CONFIGURATION

END MODULE YOMSRFTLAD
