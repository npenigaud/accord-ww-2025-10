
SUBROUTINE ACVPPKF (YDCST, YDML_PHY_MF, YDCPG_BNDS, YDCPG_OPTS, KTDIA&
&, PAPRSF, PAPHIF, PDELP, PR, PT, PQ, PQL, PQI, PU, PV, PCP, PTKE, PDIFCQ&
&, PDIFCS, PFCCQL, PFCCQN, PPRODTH, KNLAB, PQCPP, PNEBPP, KNND)
USE MODEL_PHYSICS_MF_MOD,ONLY:MODEL_PHYSICS_MF_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE YOMCST,ONLY:TCST
USE YOMLSFORC,ONLY:LMUSCLFA, NMUSCLFA
USE MODD_CONVPAR_SHAL,ONLY:CONVPAR_SHAL
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MODI_SHALLOW_CONVECTION_PART1,ONLY:SHALLOW_CONVECTION_PART1
USE MODI_SHALLOW_CONVECTION_PART2,ONLY:SHALLOW_CONVECTION_PART2
USE MODI_SHALLOW_CONVECTION_PART2_SELECT,ONLY:SHALLOW_CONVECTION_PART2_SELECT

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (MODEL_PHYSICS_MF_TYPE), INTENT (IN)::YDML_PHY_MF
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
REAL (KIND=JPRB), INTENT (IN)::PAPRSF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PDELP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PR (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PQI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PU (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PCP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PTKE (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDIFCQ (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PDIFCS (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFCCQL (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PFCCQN (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PPRODTH (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
INTEGER (KIND=JPIM), INTENT (OUT)::KNLAB (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PQCPP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::PNEBPP (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
INTEGER (KIND=JPIM), INTENT (OUT)::KNND (YDCPG_OPTS%KLON)

#include "wrscmr.intfb.h"
#include "acvppkf_part3.intfb.h"
#include "acvppkf_part2.intfb.h"
#include "acvppkf_part1.intfb.h"
#include "acvppkf_part0.intfb.h"
INTEGER (KIND=JPIM), PARAMETER::I_KCH1=0
LOGICAL::LLCONDWT
LOGICAL::LLOCHTRANS
LOGICAL::LLUVTRANS
LOGICAL::LLDOWN
LOGICAL::LLREFRESH_ALL


REAL (KIND=JPRB)::ZEPS

REAL (KIND=JPRB)::ZSMD
REAL (KIND=JPRB)::ZWMD
REAL (KIND=JPRB)::ZVMD
REAL (KIND=JPRB)::ZDTCONV
INTEGER (KIND=JPIM)::IKICE
INTEGER (KIND=JPIM)::I_KBDIA



INTEGER (KIND=JPIM)::I_KCLTOP (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM)::I_KCLBAS (YDCPG_OPTS%KLON)


REAL (KIND=JPRB)::ZDTDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZDQVDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZDQLDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZDQIDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZDUDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZDVDT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZUMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZUQV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZUQL (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZDPSG (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZLV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZLS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZQC (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)






REAL (KIND=JPRB)::ZTKECLS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZUMFMAX (YDCPG_OPTS%KLON)


REAL (KIND=JPRB)::ZT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZRV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZRC (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZRI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)


REAL (KIND=JPRB)::ZZW (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZPABS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZZZ (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZTTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZRVTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZRCTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZRITEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZUTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZVTEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZZUMF (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZURV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZURCI (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
INTEGER (KIND=JPIM)::ICLTOP (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM)::ICLBAS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSHAL_ZCH1 (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, I_KCH1)
REAL (KIND=JPRB)::ZSHAL_ZCH1TEN (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, I_KCH1)
REAL (KIND=JPRB)::ZSHAL_ZCH1TENS (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, I_KCH1)
INTEGER (KIND=JPIM)::ICLTOPS (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM)::ICLBASS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZRDOCP
REAL (KIND=JPRB)::ZTHT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTHV (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTHES (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
INTEGER (KIND=JPIM)::ISDPL (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM)::ISPBL (YDCPG_OPTS%KLON)
INTEGER (KIND=JPIM)::ISLCL (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSTHLCL (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSTLCL (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSRVLCL (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSWLCL (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSZLCL (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSTHVELCL (YDCPG_OPTS%KLON)
LOGICAL::LLTRIG1 (YDCPG_OPTS%KLON)
TYPE (DIMPHYEX_T)::D
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('ACVPPKF', 0, ZHOOK_HANDLE)


D%NIT=YDCPG_OPTS%KLON
D%NIB=YDCPG_BNDS%KIDIA
D%NIE=YDCPG_BNDS%KFDIA
D%NKT=YDCPG_OPTS%KFLEVG
ZVMD=YDCST%RCPV-YDCST%RCPD
ZWMD=YDCST%RCW-YDCST%RCPD
ZSMD=YDCST%RCS-YDCST%RCPD
I_KBDIA=1
IKICE=1
LLREFRESH_ALL=.TRUE.
LLDOWN=YDML_PHY_MF%YRPHY%LCVDD
LLUVTRANS=.FALSE.
LLOCHTRANS=.FALSE.
ZDTCONV=YDML_PHY_MF%YRPHY2%TSPHY
ZEPS=1.E-12_JPRB
ZRDOCP=YDML_PHY_MF%YRCVMNH%YRCST_MNH%XRD/YDML_PHY_MF%YRCVMNH%YRCST_MNH%XCPD
LLCONDWT=.FALSE.

CALL ACVPPKF_PART0 (LLOCHTRANS, I_KCH1, YDCPG_BNDS, YDCPG_OPTS, YDCST, YDML_PHY_MF, ICLBAS&
&, ICLBASS, ICLTOP, ICLTOPS, I_KCLBAS, I_KCLTOP, PAPHIF, PAPRSF, PDELP, PQ, PQI, PQL, PT&
&, PTKE, PU, PV, ZDPSG, ZDQIDT, ZDQLDT, ZDQVDT, ZDTDT, ZDUDT, ZDVDT, ZLS, ZLV, ZPABS, ZQC&
&, ZRC, ZRCTEN, ZRI, ZRITEN, ZRV, ZRVTEN, ZSHAL_ZCH1, ZSHAL_ZCH1TEN, ZT, ZTKECLS, ZTTEN&
&, ZUMF, ZUMFMAX, ZUQL, ZUQV, ZURCI, ZURV, ZUTEN, ZVTEN, ZZUMF, ZZW, ZZZ)
CALL ACVPPKF_PART1 (LLOCHTRANS, D, IKICE, I_KBDIA, I_KCH1, KTDIA, YDCPG_OPTS, YDML_PHY_MF&
&, ICLBASS, ICLTOPS, ISDPL, ISLCL, ISPBL, LLTRIG1, ZPABS, ZRC, ZRCTEN, ZRI, ZRITEN&
&, ZRV, ZRVTEN, ZSHAL_ZCH1, ZSHAL_ZCH1TENS, ZSRVLCL, ZSTHES, ZSTHLCL, ZSTHV, ZSTHVELCL&
&, ZSTLCL, ZSWLCL, ZSZLCL, ZT, ZTHT, ZTKECLS, ZTTEN, ZZUMF, ZZW, ZZZ)
CALL ACVPPKF_PART2 (LLOCHTRANS, D, IKICE, I_KCH1, YDCPG_OPTS, YDML_PHY_MF, ZRDOCP&
&, ICLBASS, ICLTOPS, ISDPL, ISLCL, ISPBL, LLTRIG1, ZPABS, ZRC, ZRCTEN, ZRI, ZRITEN&
&, ZRV, ZRVTEN, ZSHAL_ZCH1, ZSHAL_ZCH1TENS, ZSRVLCL, ZSTHES, ZSTHLCL, ZSTHV, ZSTHVELCL&
&, ZSTLCL, ZSWLCL, ZSZLCL, ZT, ZTHT, ZTTEN, ZZUMF, ZZZ)
CALL ACVPPKF_PART3 (LLCONDWT, LLOCHTRANS, I_KCH1, YDCPG_BNDS, YDCPG_OPTS, YDCST, YDML_PHY_MF&
&, ZEPS, ZSMD, ZVMD, ZWMD, ICLBAS, ICLBASS, ICLTOP, ICLTOPS, I_KCLBAS, I_KCLTOP, KNLAB, KNND&
&, PAPRSF, PCP, PDIFCQ, PDIFCS, PFCCQL, PFCCQN, PNEBPP, PPRODTH, PQCPP, PR, PT, ZDPSG, ZDQIDT&
&, ZDQLDT, ZDQVDT, ZDTDT, ZDUDT, ZDVDT, ZLS, ZLV, ZQC, ZRCTEN, ZRITEN, ZRVTEN, ZSHAL_ZCH1TEN&
&, ZTTEN, ZUMF, ZUMFMAX, ZUQL, ZUQV, ZURCI, ZURV, ZUTEN, ZVTEN, ZZUMF)

IF (LMUSCLFA) THEN
  
  CALL WRSCMR (NMUSCLFA,'ZMF_shal', ZUMF, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
  
ENDIF


IF (LHOOK) CALL DR_HOOK ('ACVPPKF', 1, ZHOOK_HANDLE)
ENDSUBROUTINE ACVPPKF
