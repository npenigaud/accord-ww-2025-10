SUBROUTINE CPG_DIA_FLU (YDCPG_BNDS, YDCPG_OPTS, YDCPG_MISC, YDMF_PHYS_OUT&
&, YDCPG_DYN0, YDMF_PHYS_SURF, YDVARS, YDCFU, YDXFU, YDMODEL)
USE YOMHOOK,ONLY:DR_HOOK, LHOOK, JPHOOK
USE PARKIND1,ONLY:JPIM, JPRB
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_TYPE_MOD,ONLY:CPG_DYN_TYPE, CPG_MISC_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_OUT_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE YOMCFU,ONLY:TCFU
USE YOMXFU,ONLY:TXFU
USE TYPE_MODEL,ONLY:MODEL
USE YOMXIOS,ONLY:LXIOS

IMPLICIT NONE


TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_MISC_TYPE), INTENT (IN)::YDCPG_MISC
TYPE (MF_PHYS_OUT_TYPE), INTENT (IN)::YDMF_PHYS_OUT
TYPE (CPG_DYN_TYPE), INTENT (IN)::YDCPG_DYN0
TYPE (MF_PHYS_SURF_TYPE), INTENT (IN)::YDMF_PHYS_SURF
TYPE (FIELD_VARIABLES), INTENT (IN)::YDVARS
TYPE (TCFU), INTENT (INOUT)::YDCFU
TYPE (TXFU), INTENT (INOUT)::YDXFU
TYPE (MODEL), INTENT (IN)::YDMODEL
#include "cpcfu.intfb.h"
#include "cpg_dia_flu_outline_004.intfb.h"
#include "cpg_dia_flu_outline_003.intfb.h"
#include "cpg_dia_flu_outline_002.intfb.h"
#include "cpg_dia_flu_outline_001.intfb.h"
#include "cpg_dia_flu_outline_000.intfb.h"
#include "cpxfu.intfb.h"
#include "cumcpl.intfb.h"
#include "cpcls_assim.intfb.h"
#include "cpg_dia_flu_xios.intfb.h"
LOGICAL::LLCALL_CPCFU
LOGICAL::LLCALL_CPXFU
LOGICAL::LLCALL_CUMCPLDM
REAL (KIND=JPRB)::ZDPRECIPS (YDCPG_OPTS%KLON, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS%NDTPREC)
REAL (KIND=JPRB)::ZDPRECIPS2 (YDCPG_OPTS%KLON, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS%NDTPREC2)
REAL (KIND=JPRB)::ZSTRCU (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTRCV (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTRDU (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTRDV (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTRTU (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZSTRTV (YDCPG_OPTS%KLON, 0:YDCPG_OPTS%KFLEVG)
REAL (KIND=JPRB)::ZUGST (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZVGST (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZUCLS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZNUCLS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZVCLS (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZNVCLS (YDCPG_OPTS%KLON)

REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('CPG_DIA_FLU', 0, ZHOOK_HANDLE)
LLCALL_CPCFU=YDCFU%LCUMFU.AND.(.NOT.YDCPG_OPTS%LINITER).AND.(.NOT.YDCPG_OPTS&
&%LCONFX).AND.(.NOT.YDMODEL%YRML_PHY_EC%YREPHY%LAGPHY)
LLCALL_CPXFU=YDXFU%LXFU.AND.YDCPG_OPTS%LDIAB.AND.(.NOT&
&.YDCPG_OPTS%LINITER).AND..NOT.YDCPG_OPTS%L_DFISTEP
LLCALL_CUMCPLDM=(YDMODEL%YRML_AOC%YRMCC%NFRCPL/=0).AND.(YDMODEL%YRML_AOC%YRMCC&
&%NFRCPL<=YDMODEL%YRML_GCONF%YRRIP%NSTOP).AND.(.NOT.YDCPG_OPTS%LCONFX).AND.&
&(.NOT.YDMODEL%YRML_PHY_EC%YREPHY%LAGPHY).AND.(.NOT.YDCPG_OPTS%LAROME)

IF (LLCALL_CPCFU.OR.LLCALL_CPXFU.OR.LLCALL_CUMCPLDM) THEN
  CALL CPG_DIA_FLU_OUTLINE_000 (YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS_OUT&
  &, ZSTRCU, ZSTRCV, ZSTRDU, ZSTRDV, ZSTRTU, ZSTRTV)
ENDIF


IF (LLCALL_CPXFU.OR.YDMODEL%YRML_PHY_G%YRDPHY%LDIRCLSMOD) THEN
  CALL CPG_DIA_FLU_OUTLINE_001 (YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS_OUT&
  &, ZNUCLS, ZNVCLS, ZUCLS, ZUGST, ZVCLS, ZVGST)
ENDIF


IF (YDCPG_OPTS%LDIAB.OR.(YDMODEL%YRML_PHY_MF%YRSIMPHL%LSIMPH&
  &.AND.(.NOT.YDMODEL%YRML_PHY_MF%YRSIMPHL%LTRAJPS))) THEN

  IF (LLCALL_CPCFU.OR.LLCALL_CPXFU.OR.LLCALL_CUMCPLDM) THEN
    CALL CPG_DIA_FLU_OUTLINE_002 (YDCPG_BNDS, YDCPG_OPTS, YDVARS&
    &, ZSTRCU, ZSTRCV, ZSTRDU, ZSTRDV, ZSTRTU, ZSTRTV)
  ENDIF


  IF (LLCALL_CPXFU.OR.YDMODEL%YRML_PHY_G%YRDPHY%LDIRCLSMOD) THEN
    CALL CPG_DIA_FLU_OUTLINE_003 (YDCPG_BNDS, YDCPG_OPTS, YDVARS&
    &, ZNUCLS, ZNVCLS, ZUCLS, ZUGST, ZVCLS, ZVGST)
  ENDIF

ENDIF


IF (LLCALL_CPCFU) THEN
  CALL CPCFU (YDMODEL%YRCST, YDCFU, YDMODEL%YRML_GCONF%YRRIP, YDCPG_OPTS, YDCPG_BNDS, YDMF_PHYS_OUT, YDCPG_MISC&
  &, YDCPG_DYN0, YDVARS, YDMF_PHYS_SURF, ZSTRCU, ZSTRCV, ZSTRDU, ZSTRDV, ZSTRTU, ZSTRTV)
ENDIF


IF (LLCALL_CUMCPLDM) THEN
  
  CALL CUMCPL (YDMODEL%YRCST, YDCPG_OPTS, YDCPG_BNDS, YDMODEL%YRML_GCONF%YRRIP&
  &, YDMODEL%YRML_PHY_MF%YRPHY, YDMF_PHYS_OUT, ZSTRTU (:, YDCPG_OPTS%KFLEVG), ZSTRTV&
  & (:, YDCPG_OPTS%KFLEVG), YDMF_PHYS_SURF%GSP_RR%PT_T0, ZUCLS, ZVCLS)
  
ENDIF


IF (LLCALL_CPXFU) THEN
  CALL CPG_DIA_FLU_OUTLINE_004 (YDCPG_BNDS, YDCPG_OPTS&
  &, YDMF_PHYS_SURF, YDMODEL, ZDPRECIPS, ZDPRECIPS2)
  CALL CPXFU (YDXFU, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YDCPG_OPTS, YDCPG_BNDS&
  &, YDMF_PHYS_OUT, YDCPG_MISC, ZSTRCU, ZSTRCV, ZSTRDU, ZSTRDV, ZSTRTU, ZSTRTV&
  &, ZUCLS, ZVCLS, ZNUCLS, ZNVCLS, ZUGST, ZVGST, ZDPRECIPS, ZDPRECIPS2)
ENDIF


IF (YDMODEL%YRML_PHY_G%YRDPHY%LDIRCLSMOD) THEN
  
  CALL CPCLS_ASSIM (YDMODEL, YDCPG_OPTS, YDCPG_BNDS, YDMF_PHYS_SURF&
  &, YDMF_PHYS_OUT, ZUCLS, ZVCLS, ZNUCLS, ZNVCLS)
  
ENDIF


IF (LXIOS) THEN
  
  CALL CPG_DIA_FLU_XIOS (YDCPG_OPTS, YDMF_PHYS_OUT)
  
ENDIF

IF (LHOOK) CALL DR_HOOK ('CPG_DIA_FLU', 1, ZHOOK_HANDLE)
ENDSUBROUTINE CPG_DIA_FLU
