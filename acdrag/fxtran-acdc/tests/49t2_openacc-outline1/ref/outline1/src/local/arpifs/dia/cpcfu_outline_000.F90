SUBROUTINE CPCFU_OUTLINE_000 (LDRESET, JLEV, YDCFU, YDCPG_BNDS, YDCPG_OPTS, YDMF_PHYS_OUT, YDRIP)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_OUT_TYPE
USE YOMCFU,ONLY:TCFU
USE YOMRIP,ONLY:TRIP
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

LOGICAL, INTENT (INOUT)::LDRESET
INTEGER (KIND=JPIM), INTENT (INOUT)::JLEV
TYPE (TCFU), INTENT (INOUT)::YDCFU
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_OUT_TYPE), INTENT (IN)::YDMF_PHYS_OUT
TYPE (TRIP), INTENT (IN)::YDRIP
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPRB), PARAMETER::ZEPS=EPSILON (1.0_JPRB)*100._JPRB
REAL (KIND=JPRB)::ZFPREC0 (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZFPREC9 (YDCPG_OPTS%KLON)
REAL (KIND=JPRB)::ZSQPRE (YDCPG_OPTS%KLON)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('CPCFU_OUTLINE_000', 0, ZHOOK_HANDLE)
ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=0.0_JPRB
ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=0.0_JPRB
ZSQPRE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=0.0_JPRB

IF (YDCFU%YFPLCL%LACTIVE) THEN
  JLEV=YDCFU%YFPLCL%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLCL (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLCL (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLCL%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLCN%LACTIVE) THEN
  JLEV=YDCFU%YFPLCN%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLCN (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLCN (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLCN%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLCG%LACTIVE) THEN
  JLEV=YDCFU%YFPLCG%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLCG (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLCG (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLCG%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLCH%LACTIVE) THEN
  JLEV=YDCFU%YFPLCH%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLCH (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLCH (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLCH%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLSL%LACTIVE) THEN
  JLEV=YDCFU%YFPLSL%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLSL (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLSL (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLSL%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLSN%LACTIVE) THEN
  JLEV=YDCFU%YFPLSN%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLSN (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLSN (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLSN%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLSG%LACTIVE) THEN
  JLEV=YDCFU%YFPLSG%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLSG (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLSG (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLSG%INUMLEV (JLEV))
ENDIF


IF (YDCFU%YFPLSH%LACTIVE) THEN
  JLEV=YDCFU%YFPLSH%ILEV

  IF (.NOT.LDRESET) THEN
    ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC9 (YDCPG_BNDS%KIDIA:YDCPG_BNDS&
    &%KFDIA)+YDCFU%FPLSH (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, JLEV)
  ENDIF

  ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)+YDMF_PHYS_OUT&
  &%FPLSH (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA, YDCFU%YFPLSH%INUMLEV (JLEV))
ENDIF

ZSQPRE (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=(ZFPREC0 (YDCPG_BNDS&
&%KIDIA:YDCPG_BNDS%KFDIA)**2)*YDRIP%TSTEP
ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=ZFPREC0 (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)*YDRIP%TSTEP

IF (LDRESET) THEN
  YDCFU%FDUTP (YDCPG_BNDS%KIDIA:YDCPG_BNDS%KFDIA)=0._JPRB
ENDIF


DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA

  IF (ZFPREC9 (JLON)>ZEPS) THEN
    YDCFU%FDUTP (JLON)=YDCFU%FDUTP (JLON)*((ZFPREC9 (JLON)+ZFPREC0 (JLON&
    &))**2)/((ZFPREC9 (JLON)**2)+(YDCFU%FDUTP (JLON)*ZSQPRE (JLON)))
  ELSEIF (ZFPREC0 (JLON)>ZEPS) THEN
    YDCFU%FDUTP (JLON)=YDRIP%TSTEP
  ELSE
    YDCFU%FDUTP (JLON)=0.0_JPRB
  ENDIF

ENDDO

IF (LHOOK) CALL DR_HOOK ('CPCFU_OUTLINE_000', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
