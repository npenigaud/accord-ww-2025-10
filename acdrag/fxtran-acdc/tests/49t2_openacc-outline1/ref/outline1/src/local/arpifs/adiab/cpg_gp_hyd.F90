SUBROUTINE CPG_GP_HYD (YDGEOMETRY, YDCPG_BNDS, YDCPG_OPTS, YDVARS, YDCPG_DYN0, YDCPG_DYN9&
&, YDMODEL, P_OROGLL_T0, P_OROGMM_T0, P_OROGLM_T0, P_GDW_T0, P_GWHT_T0, YDCPG_TND)
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE CPG_TYPE_MOD,ONLY:CPG_DYN_TYPE, CPG_TND_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE TYPE_MODEL,ONLY:MODEL
USE PARKIND1,ONLY:JPIM, JPRB
USE YOMHOOK,ONLY:DR_HOOK, JPHOOK, LHOOK
USE YOMGWDIAG,ONLY:LGWDIAGS_ON, UPDATE_GWDIAG
USE INTDYN_MOD,ONLY:TPG_TYPE

IMPLICIT NONE


TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (CPG_DYN_TYPE), INTENT (INOUT)::YDCPG_DYN0
TYPE (CPG_DYN_TYPE), INTENT (INOUT)::YDCPG_DYN9
TYPE (MODEL), INTENT (IN)::YDMODEL
REAL (KIND=JPRB), INTENT (INOUT)::P_OROGLL_T0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (INOUT)::P_OROGMM_T0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (INOUT)::P_OROGLM_T0 (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (INOUT)::P_GDW_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (INOUT)::P_GWHT_T0 (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)
TYPE (CPG_TND_TYPE), INTENT (INOUT)::YDCPG_TND


#include "gprcp_expl.intfb.h"
#include "cpg_gp_hyd_outline_003.intfb.h"
#include "cpg_gp_hyd_outline_002.intfb.h"
#include "cpg_gp_hyd_outline_001.intfb.h"
#include "cpg_gp_hyd_outline_000.intfb.h"


#include "gpcty_forc.intfb.h"









#include "cpg_gp_hyd_t9.intfb.h"


REAL (KIND=JPRB)::Z_GPHL_T0 (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_GPHM_T0 (YDGEOMETRY%YRDIM%NPROMA, 0:YDGEOMETRY%YRDIMV%NFLEVG)



REAL (KIND=JPRB)::Z_RDT_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_RPREF_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_RT_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)




REAL (KIND=JPRB)::Z_XYBDER_ALPHL_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_XYBDER_ALPHM_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_XYBDER_ALPHPLL_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_XYBDER_ALPHPLM_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)



REAL (KIND=JPRB)::Z_XYBDER_LNPRL_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB)::Z_XYBDER_LNPRM_T0 (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
LOGICAL::LLUVH
LOGICAL::LLGPXX





REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('CPG_GP_HYD', 0, ZHOOK_HANDLE)







IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE.AND..NOT.YDGEOMETRY%YRVERT_GEOM%YRCVER&
  &%LVFE_ECMWF.OR..NOT.((YDMODEL%YRML_PHY_MF%YRPHY%LMPHYS.OR.YDMODEL%YRML_PHY_MF&
  &%YRSIMPHL%LSIMPH).AND.YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==0)) THEN
  LLGPXX=.FALSE.
ELSE
  LLGPXX=.TRUE.
ENDIF

LLUVH=LLGPXX.OR.YDMODEL%YRML_DYN%YRDYNA%LSLHD
CALL CPG_GP_HYD_OUTLINE_000 (YDCPG_BNDS, YDCPG_DYN0, YDCPG_OPTS, YDGEOMETRY&
&, YDMODEL, Z_RPREF_T0, Z_XYBDER_ALPHL_T0, Z_XYBDER_ALPHM_T0, Z_XYBDER_ALPHPLL_T0&
&, Z_XYBDER_ALPHPLM_T0, Z_XYBDER_LNPRL_T0, Z_XYBDER_LNPRM_T0)
CALL GPRCP_EXPL (YDMODEL%YRCST, YDCPG_BNDS, YDCPG_OPTS, YDVARS=YDVARS, PCP&
&=YDCPG_DYN0%RCP%CP, PR=YDCPG_DYN0%RCP%R, PKAP=YDCPG_DYN0%RCP%KAP)
CALL CPG_GP_HYD_OUTLINE_001 (YDCPG_BNDS, YDCPG_DYN0, YDGEOMETRY&
&, YDMODEL, YDVARS, Z_RDT_T0, Z_RPREF_T0, Z_RT_T0)

IF (LGWDIAGS_ON) THEN
  
  CALL UPDATE_GWDIAG (YDGEOMETRY, YDMODEL%YRML_GCONF%YRRIP, YDGEOMETRY%YRDIM&
  &%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG, YDCPG_BNDS%KFDIA, YDCPG_OPTS%NSTEP,&
  & YDCPG_BNDS%KSTGLO, YDCPG_DYN0%PRE, YDCPG_DYN0%CTY%DIVDP (:, 1:))
  
ENDIF


IF (YDCPG_OPTS%LSFORC.AND.(YDCPG_OPTS%LSW_FRC.OR.YDCPG_OPTS%LSOMEGA_FRC)) THEN
  
  CALL GPCTY_FORC (YDMODEL%YRCST, YDGEOMETRY, YDMODEL%YRML_GCONF, YDMODEL&
  &%YRML_PHY_MF%YRPHY2, YDCPG_BNDS, YDCPG_OPTS, YDVARS, YDCPG_DYN0)
  
ENDIF

CALL CPG_GP_HYD_OUTLINE_002 (LLGPXX, LLUVH, YDCPG_BNDS, YDCPG_DYN0, YDCPG_OPTS, YDCPG_TND, YDGEOMETRY&
&, YDMODEL, YDVARS, P_GWHT_T0, Z_GPHL_T0, Z_GPHM_T0, Z_RDT_T0, Z_RT_T0, Z_XYBDER_ALPHL_T0, Z_XYBDER_ALPHM_T0&
&, Z_XYBDER_ALPHPLL_T0, Z_XYBDER_ALPHPLM_T0, Z_XYBDER_LNPRL_T0, Z_XYBDER_LNPRM_T0)

IF (.NOT.YDMODEL%YRML_DYN%YRDYNA%LTWOTL.AND.YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==0) THEN
  
  CALL CPG_GP_HYD_T9 (YDGEOMETRY, YDCPG_BNDS, YDCPG_OPTS, YDVARS, YDCPG_DYN0&
  &, YDMODEL, LLGPXX, YDMODEL%YRML_DYN%YRDYNA%L_RDRY_VD, Z_GPHL_T0, Z_GPHM_T0&
  &, YDCPG_DYN9, YDCPG_OPTS%LDIAB, YDMODEL%YRML_PHY_MF%YRARPHY%LMPA)
  
ENDIF

CALL CPG_GP_HYD_OUTLINE_003 (YDGEOMETRY, P_GWHT_T0)



IF (LHOOK) CALL DR_HOOK ('CPG_GP_HYD', 1, ZHOOK_HANDLE)
ENDSUBROUTINE CPG_GP_HYD
