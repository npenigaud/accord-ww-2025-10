SUBROUTINE APL_ARPEGE_MWAVE_OUTLINE_000 (YDCPG_BNDS, YDCPG_MISC, YDCPG_OPTS, YDMF_PHYS, YDPHYSMWAVE)
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_TYPE_MOD,ONLY:CPG_MISC_TYPE
USE PARKIND1,ONLY:JPIM, JPRB
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE YOE_PHYS_MWAVE,ONLY:TEPHYSMWAVE
USE YOMHOOK,ONLY:LHOOK, JPHOOK, DR_HOOK

IMPLICIT NONE

TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_MISC_TYPE), INTENT (IN)::YDCPG_MISC
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (IN)::YDMF_PHYS
TYPE (TEPHYSMWAVE), INTENT (INOUT)::YDPHYSMWAVE
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPRB)::ZCOVPTOT (YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_MWAVE_OUTLINE_000', 0, ZHOOK_HANDLE)
ZCOVPTOT (:,:)=0.0_JPRB

DO JLEV=1, YDCPG_OPTS%KFLEVG

  DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA

    IF (JLEV>0) THEN

      IF (ABS (0.5*(YDMF_PHYS%OUT%FPLSL (JLON, JLEV)+YDMF_PHYS%OUT%FPLSL (JLON, JLEV-1))+0&
        &.5*(YDMF_PHYS%OUT%FPLSN (JLON, JLEV)+YDMF_PHYS%OUT%FPLSN (JLON, JLEV-1))+0.5*(YDMF_PHYS&
        &%OUT%FPLCN (JLON, JLEV)+YDMF_PHYS%OUT%FPLCN (JLON, JLEV-1))+0.5*(YDMF_PHYS%OUT%FPLCL&
        & (JLON, JLEV)+YDMF_PHYS%OUT%FPLCL (JLON, JLEV-1)))>=1.E-25_JPRB) THEN

        IF (JLEV==1_JPIM) THEN
          ZCOVPTOT (JLON, JLEV)=1.0_JPRB-((1.0_JPRB-ZCOVPTOT (JLON, JLEV&
          &))*(1.0_JPRB-YDCPG_MISC%NEB (JLON, JLEV))/1.E-06_JPRB)
        ELSE
          ZCOVPTOT (JLON, JLEV)=1.0_JPRB-((1.0_JPRB-ZCOVPTOT (JLON, JLEV-1))*(1.0_JPRB&
          &-MAX (YDCPG_MISC%NEB (JLON, JLEV), YDCPG_MISC%NEB (JLON, JLEV-1)))/(1.0_JPRB&
          &-MIN (YDCPG_MISC%NEB (JLON, JLEV-1), 1.0_JPRB-1.E-06_JPRB)))
        ENDIF

        ZCOVPTOT (JLON, JLEV)=MAX (ZCOVPTOT (JLON, JLEV), 0.1_JPRB)
      ENDIF

    ENDIF

    YDPHYSMWAVE%P (JLON, JLEV, 1)=YDCPG_MISC%QLI (JLON, JLEV)
    YDPHYSMWAVE%P (JLON, JLEV, 2)=YDCPG_MISC%QICE (JLON, JLEV)
    YDPHYSMWAVE%P (JLON, JLEV, 3)=YDCPG_MISC%NEB (JLON, JLEV)
    YDPHYSMWAVE%P (JLON, JLEV, 4)=0.5*(YDMF_PHYS%OUT%FPLSL&
    & (JLON, JLEV)+YDMF_PHYS%OUT%FPLSL (JLON, JLEV-1))
    YDPHYSMWAVE%P (JLON, JLEV, 5)=0.5*(YDMF_PHYS%OUT%FPLSN&
    & (JLON, JLEV)+YDMF_PHYS%OUT%FPLSN (JLON, JLEV-1))
    YDPHYSMWAVE%P (JLON, JLEV, 6)=0.5*(YDMF_PHYS%OUT%FPLCL&
    & (JLON, JLEV)+YDMF_PHYS%OUT%FPLCL (JLON, JLEV-1))
    YDPHYSMWAVE%P (JLON, JLEV, 7)=0.5*(YDMF_PHYS%OUT%FPLCN&
    & (JLON, JLEV)+YDMF_PHYS%OUT%FPLCN (JLON, JLEV-1))
    YDPHYSMWAVE%P (JLON, JLEV, 8)=ZCOVPTOT (JLON, JLEV)
  ENDDO

ENDDO


DO JLON=YDCPG_BNDS%KIDIA, YDCPG_BNDS%KFDIA
  YDPHYSMWAVE%P (JLON, 1, 9)=0._JPRB
  YDPHYSMWAVE%P (JLON, 2, 9)=0._JPRB
  YDPHYSMWAVE%P (JLON, 3:YDCPG_OPTS%KFLEVG, 9)=0._JPRB
ENDDO

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_MWAVE_OUTLINE_000', 1, ZHOOK_HANDLE)
ENDSUBROUTINE
