SUBROUTINE CUCCDIA_OPENACC (YDERAD, YDEPHLI, YDEPHY, KIDIA, KFDIA, KLON, KLEV, KSTEP&
&, KCBOT, KCTOP, LDCUM, PQU, PLU, PMFU, PRAIN, PARPRC, KTOPC, KBASEC, YDSTACK)
!$ACC ROUTINE (CUCCDIA_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE YOEPHY,ONLY:TEPHY
USE YOERAD,ONLY:TERAD
USE YOEPHLI,ONLY:TEPHLI
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TEPHLI), INTENT (IN)::YDEPHLI
TYPE (TEPHY), INTENT (IN)::YDEPHY
TYPE (TERAD), INTENT (IN)::YDERAD
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KSTEP
INTEGER (KIND=JPIM), INTENT (IN)::KCBOT 
INTEGER (KIND=JPIM), INTENT (IN)::KCTOP 
LOGICAL, INTENT (IN)::LDCUM 
REAL (KIND=JPRB), INTENT (IN)::PQU 
REAL (KIND=JPRB), INTENT (IN)::PLU 
REAL (KIND=JPRB), INTENT (IN)::PMFU 
REAL (KIND=JPRB), INTENT (IN)::PRAIN 
REAL (KIND=JPRB), INTENT (INOUT)::PARPRC 
INTEGER (KIND=JPIM), INTENT (INOUT)::KTOPC 
INTEGER (KIND=JPIM), INTENT (INOUT)::KBASEC 
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK

fxtran_acdc_temp (INTEGER(KIND=JPIM), KCBOT_PTR, (KLON))
fxtran_acdc_temp (INTEGER(KIND=JPIM), KCTOP_PTR, (KLON))
fxtran_acdc_temp (LOGICAL, LDCUM_PTR, (KLON))
fxtran_acdc_temp (REAL(KIND=JPRB), PQU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PLU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PMFU_PTR, (KLON, KLEV))
fxtran_acdc_temp (REAL(KIND=JPRB), PRAIN_PTR, (KLON))
fxtran_acdc_temp (REAL(KIND=JPRB), PARPRC_PTR, (KLON))
fxtran_acdc_temp (INTEGER(KIND=JPIM), KTOPC_PTR, (KLON))
fxtran_acdc_temp (INTEGER(KIND=JPIM), KBASEC_PTR, (KLON))

INTEGER (KIND=JPIM)::JL
INTEGER (KIND=JPIM)::IKT
INTEGER (KIND=JPIM)::IKB
REAL (KIND=JPRB)::ZNORMR
REAL (KIND=JPRB)::ZDMFQ


fxtran_acdc_assoc (KCBOT_PTR, KCBOT)

fxtran_acdc_assoc (KCTOP_PTR, KCTOP)

fxtran_acdc_assoc (LDCUM_PTR, LDCUM)

fxtran_acdc_assoc (PQU_PTR, PQU)

fxtran_acdc_assoc (PLU_PTR, PLU)

fxtran_acdc_assoc (PMFU_PTR, PMFU)

fxtran_acdc_assoc (PRAIN_PTR, PRAIN)

fxtran_acdc_assoc (PARPRC_PTR, PARPRC)

fxtran_acdc_assoc (KTOPC_PTR, KTOPC)

fxtran_acdc_assoc (KBASEC_PTR, KBASEC)

JL = KIDIA





IF (.NOT.YDEPHLI%LPHYLIN.AND.YDERAD%NRADFR/=1) THEN

  IF (YDEPHY%LECUMF.AND.YDEPHY%LERADI.AND.MOD (KSTEP+1, YDERAD%NRADFR)/=0) THEN
    ZNORMR=1.0_JPRB/REAL (MAX (YDERAD%NRADFR-1, 1), JPRB)

    

    IF (LDCUM_PTR (JL)) THEN
      KBASEC_PTR (JL)=MAX (KBASEC_PTR (JL), KCBOT_PTR (JL))
      KTOPC_PTR (JL)=MIN (KTOPC_PTR (JL), KCTOP_PTR (JL))

      IF (KTOPC_PTR (JL)==1)  THEN
        KTOPC_PTR (JL)=KCTOP_PTR (JL)
      ENDIF

      IKB=KCBOT_PTR (JL)
      IKT=KCTOP_PTR (JL)
      ZDMFQ=PMFU_PTR (JL, IKB)*MAX (PQU_PTR (JL, IKB)+PLU_PTR (JL&
      &, IKB)-PQU_PTR (JL, IKT), PQU_PTR (JL, IKB)*0.05_JPRB)
      PARPRC_PTR (JL)=PARPRC_PTR (JL)+MAX (ZDMFQ, PRAIN_PTR (JL))*ZNORMR
    ENDIF

  
  ENDIF

ELSE

  IF (YDEPHY%LECUMF) THEN

    

    IF (LDCUM_PTR (JL)) THEN
      KBASEC_PTR (JL)=KCBOT_PTR (JL)
      KTOPC_PTR (JL)=KCTOP_PTR (JL)

      IF (KTOPC_PTR (JL)==1)  THEN
        KTOPC_PTR (JL)=KCTOP_PTR (JL)
      ENDIF

      IKB=KCBOT_PTR (JL)
      IKT=KCTOP_PTR (JL)
      ZDMFQ=PMFU_PTR (JL, IKB)*MAX (PQU_PTR (JL, IKB)+PLU_PTR (JL&
      &, IKB)-PQU_PTR (JL, IKT), PQU_PTR (JL, IKB)*0.05_JPRB)
      PARPRC_PTR (JL)=MAX (ZDMFQ, PRAIN_PTR (JL))
    ENDIF

  
  ENDIF

ENDIF



ENDSUBROUTINE CUCCDIA_OPENACC
