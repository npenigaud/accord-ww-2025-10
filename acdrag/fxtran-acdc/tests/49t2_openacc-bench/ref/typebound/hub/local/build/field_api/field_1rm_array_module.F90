
MODULE FIELD_1RM_ARRAY_MODULE

!$ACDC methods --methods-list=crc64,size,host,copy,wipe,save,load --field-api --field-api-class cpg

USE FIELD_1RM_MODULE
USE FIELD_1RM_FACTORY_MODULE

USE PARKIND1, ONLY : JPRM, JPRD, JPIM, JPLM

IMPLICIT NONE

PRIVATE

TYPE FIELD_1RM_ARRAY
  CLASS (FIELD_1RM), POINTER :: F_P => NULL ()
  REAL(KIND=JPRM), POINTER, CONTIGUOUS :: P_FIELD (:) => NULL()
CONTAINS
  GENERIC :: INIT => INIT_FIELD_1RM_ARRAY_WRAPPER, INIT_FIELD_1RM_ARRAY_OWNER
  PROCEDURE, PRIVATE :: INIT_FIELD_1RM_ARRAY_WRAPPER
  PROCEDURE, PRIVATE :: INIT_FIELD_1RM_ARRAY_OWNER
  PROCEDURE :: RESIZE => RESIZE_FIELD_1RM_ARRAY
  PROCEDURE :: FINAL => FINAL_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_COPY => ACDC_COPY_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_CRC64 => ACDC_CRC64_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_HOST => ACDC_HOST_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_LOAD => ACDC_LOAD_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_SAVE => ACDC_SAVE_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_SIZE => ACDC_SIZE_FIELD_1RM_ARRAY
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_FIELD_1RM_ARRAY
END TYPE

PUBLIC :: FIELD_1RM_ARRAY


INTERFACE

MODULE SUBROUTINE ACDC_COPY_FIELD_1RM_ARRAY (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_CRC64_FIELD_1RM_ARRAY (SELF, KLUN, CDPATH)
USE FIELD_UTIL_MODULE
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_FIELD_1RM_ARRAY (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_LOAD_FIELD_1RM_ARRAY (SELF, KLUN)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE SUBROUTINE ACDC_SAVE_FIELD_1RM_ARRAY (SELF, KLUN)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
END SUBROUTINE

MODULE FUNCTION ACDC_SIZE_FIELD_1RM_ARRAY (SELF, CDPATH, LDPRINT) RESULT (KSIZE)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
END FUNCTION

MODULE SUBROUTINE ACDC_WIPE_FIELD_1RM_ARRAY (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (FIELD_1RM_ARRAY), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS

SUBROUTINE INIT_FIELD_1RM_ARRAY_WRAPPER (SELF, P, LBOUNDS)

CLASS (FIELD_1RM_ARRAY) :: SELF
REAL(KIND=JPRM), INTENT (IN), TARGET :: P (:)
INTEGER (KIND=JPIM), INTENT (IN), OPTIONAL :: LBOUNDS (1)

IF(SIZE(P) > 0) CALL FIELD_NEW (SELF%F_P, DATA=P, PERSISTENT=.TRUE., LBOUNDS=LBOUNDS)

END SUBROUTINE

SUBROUTINE INIT_FIELD_1RM_ARRAY_OWNER (SELF, PERSISTENT, UBOUNDS, LBOUNDS)

CLASS (FIELD_1RM_ARRAY) :: SELF
INTEGER (KIND=JPIM), INTENT (IN) :: UBOUNDS (1)
INTEGER (KIND=JPIM), INTENT (IN), OPTIONAL :: LBOUNDS (1)
LOGICAL,             INTENT (IN), OPTIONAL :: PERSISTENT

CALL FIELD_NEW (SELF%F_P, UBOUNDS=UBOUNDS, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)

END SUBROUTINE

SUBROUTINE RESIZE_FIELD_1RM_ARRAY (SELF, UBOUNDS, LBOUNDS, PERSISTENT)

CLASS (FIELD_1RM_ARRAY) :: SELF
INTEGER (KIND=JPIM), INTENT (IN) :: UBOUNDS (1)
INTEGER (KIND=JPIM), INTENT (IN), OPTIONAL :: LBOUNDS (1)
LOGICAL,             INTENT (IN), OPTIONAL :: PERSISTENT

CALL FIELD_RESIZE (SELF%F_P, UBOUNDS=UBOUNDS, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)

END SUBROUTINE


SUBROUTINE FINAL_FIELD_1RM_ARRAY (SELF)
CLASS (FIELD_1RM_ARRAY) :: SELF

IF (ASSOCIATED (SELF%F_P)) THEN
  CALL FIELD_DELETE (SELF%F_P)
  SELF%P_FIELD => NULL ()
ENDIF

END SUBROUTINE


END MODULE
